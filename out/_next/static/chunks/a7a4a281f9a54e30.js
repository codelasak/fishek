(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,1076,e=>{"use strict";let t,n;var i,l,r,o,a,s,u,p,d,c,h,m,f,g,y,E,_,T,v,I,A,C,S,O,b,N,R,P,M,D,w,x,U,k,q,G,L,F,H,j,V,B,J,Y,K,W,$,z,X,Q,Z,ee,et,en,ei,el,er,eo,ea,es,eu,ep,ed,ec,eh,em,ef,eg,ey,eE,e_,eT,ev,eI,eA,eC,eS,eO,eb,eN,eR,eP,eM,eD,ew,ex,eU,ek,eq,eG,eL,eF,eH,ej,eV,eB,eJ,eY,eK,eW,e$,ez,eX,eQ,eZ,e0,e1,e2,e4,e5,e3,e6,e8=e.i(78042),e7=e.i(45456),e9=e.i(45227),te=e.i(79738);e.i(96241);class tt{}function tn(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function ti(e,t,n){for(let i=0;i<t.length-1;i++){let l=t[i];if(l.endsWith("[]")){let r=l.slice(0,-2);if(!(r in e))if(Array.isArray(n))e[r]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${l}`);if(Array.isArray(e[r])){let l=e[r];if(Array.isArray(n))for(let e=0;e<l.length;e++)ti(l[e],t.slice(i+1),n[e]);else for(let e of l)ti(e,t.slice(i+1),n)}return}if(l.endsWith("[0]")){let r=l.slice(0,-3);r in e||(e[r]=[{}]),ti(e[r][0],t.slice(i+1),n);return}e[l]&&"object"==typeof e[l]||(e[l]={}),e=e[l]}let i=t[t.length-1],l=e[i];if(void 0!==l){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===l)return;if("object"==typeof l&&"object"==typeof n&&null!==l&&null!==n)Object.assign(l,n);else throw Error(`Cannot set value for an existing key. Key: ${i}`)}else"_self"!==i||"object"!=typeof n||null===n||Array.isArray(n)?e[i]=n:Object.assign(e,n)}function tl(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let i=0;i<t.length;i++){if("object"!=typeof e||null===e)return n;let l=t[i];if(l.endsWith("[]")){let r=l.slice(0,-2);if(!(r in e))return n;{let l=e[r];if(!Array.isArray(l))return n;return l.map(e=>tl(e,t.slice(i+1),n))}}e=e[l]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function tr(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}function to(e){var t;let n,i,l,r,o={},a=tl(e,["name"]);null!=a&&ti(o,["name"],a);let s=tl(e,["metadata"]);null!=s&&ti(o,["metadata"],s);let u=tl(e,["done"]);null!=u&&ti(o,["done"],u);let p=tl(e,["error"]);null!=p&&ti(o,["error"],p);let d=tl(e,["response"]);return null!=d&&ti(o,["response"],(n={},null!=(i=tl(t=d,["sdkHttpResponse"]))&&ti(n,["sdkHttpResponse"],i),null!=(l=tl(t,["parent"]))&&ti(n,["parent"],l),null!=(r=tl(t,["documentName"]))&&ti(n,["documentName"],r),n)),o}(i=er||(er={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(l=eo||(eo={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",l.PYTHON="PYTHON",(r=ea||(ea={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",r.SILENT="SILENT",r.WHEN_IDLE="WHEN_IDLE",r.INTERRUPT="INTERRUPT",(o=es||(es={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT",o.NULL="NULL",(a=eu||(eu={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.MODE_DYNAMIC="MODE_DYNAMIC",(s=ep||(ep={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",s.SIMPLE_SEARCH="SIMPLE_SEARCH",s.ELASTIC_SEARCH="ELASTIC_SEARCH",(u=ed||(ed={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",u.NO_AUTH="NO_AUTH",u.API_KEY_AUTH="API_KEY_AUTH",u.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",u.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",u.OAUTH="OAUTH",u.OIDC_AUTH="OIDC_AUTH",(p=ec||(ec={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",p.HTTP_IN_QUERY="HTTP_IN_QUERY",p.HTTP_IN_HEADER="HTTP_IN_HEADER",p.HTTP_IN_PATH="HTTP_IN_PATH",p.HTTP_IN_BODY="HTTP_IN_BODY",p.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(d=eh||(eh={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",d.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",d.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",d.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",d.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",d.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",d.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(c=em||(em={})).THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",c.LOW="LOW",c.HIGH="HIGH",(h=ef||(ef={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",h.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",h.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",h.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",h.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",h.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",h.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",h.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",h.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",h.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",h.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(m=eg||(eg={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",m.SEVERITY="SEVERITY",m.PROBABILITY="PROBABILITY",(f=ey||(ey={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",f.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",f.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",f.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",f.BLOCK_NONE="BLOCK_NONE",f.OFF="OFF",(g=eE||(eE={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",g.STOP="STOP",g.MAX_TOKENS="MAX_TOKENS",g.SAFETY="SAFETY",g.RECITATION="RECITATION",g.LANGUAGE="LANGUAGE",g.OTHER="OTHER",g.BLOCKLIST="BLOCKLIST",g.PROHIBITED_CONTENT="PROHIBITED_CONTENT",g.SPII="SPII",g.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",g.IMAGE_SAFETY="IMAGE_SAFETY",g.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",g.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",g.NO_IMAGE="NO_IMAGE",(y=e_||(e_={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",y.NEGLIGIBLE="NEGLIGIBLE",y.LOW="LOW",y.MEDIUM="MEDIUM",y.HIGH="HIGH",(E=eT||(eT={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",E.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",E.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",E.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",E.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(_=ev||(ev={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",_.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",_.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",_.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",_.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(T=eI||(eI={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",T.SAFETY="SAFETY",T.OTHER="OTHER",T.BLOCKLIST="BLOCKLIST",T.PROHIBITED_CONTENT="PROHIBITED_CONTENT",T.IMAGE_SAFETY="IMAGE_SAFETY",T.MODEL_ARMOR="MODEL_ARMOR",T.JAILBREAK="JAILBREAK",(v=eA||(eA={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",v.ON_DEMAND="ON_DEMAND",v.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(I=eC||(eC={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",I.TEXT="TEXT",I.IMAGE="IMAGE",I.AUDIO="AUDIO",(A=eS||(eS={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",A.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",A.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",A.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(C=eO||(eO={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",C.TUNING_MODE_FULL="TUNING_MODE_FULL",C.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(S=eb||(eb={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",S.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",S.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",S.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",S.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",S.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",S.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(O=eN||(eN={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",O.JOB_STATE_QUEUED="JOB_STATE_QUEUED",O.JOB_STATE_PENDING="JOB_STATE_PENDING",O.JOB_STATE_RUNNING="JOB_STATE_RUNNING",O.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",O.JOB_STATE_FAILED="JOB_STATE_FAILED",O.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",O.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",O.JOB_STATE_PAUSED="JOB_STATE_PAUSED",O.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",O.JOB_STATE_UPDATING="JOB_STATE_UPDATING",O.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(b=eR||(eR={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",b.TUNING_TASK_I2V="TUNING_TASK_I2V",b.TUNING_TASK_T2V="TUNING_TASK_T2V",b.TUNING_TASK_R2V="TUNING_TASK_R2V",(N=eP||(eP={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",N.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",N.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",N.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(R=eM||(eM={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",R.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",R.BALANCED="BALANCED",R.PRIORITIZE_COST="PRIORITIZE_COST",(P=eD||(eD={})).UNSPECIFIED="UNSPECIFIED",P.BLOCKING="BLOCKING",P.NON_BLOCKING="NON_BLOCKING",(M=ew||(ew={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",M.MODE_DYNAMIC="MODE_DYNAMIC",(D=ex||(ex={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",D.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(w=eU||(eU={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",w.AUTO="AUTO",w.ANY="ANY",w.NONE="NONE",w.VALIDATED="VALIDATED",(x=ek||(ek={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",x.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",x.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",x.BLOCK_NONE="BLOCK_NONE",(U=eq||(eq={})).DONT_ALLOW="DONT_ALLOW",U.ALLOW_ADULT="ALLOW_ADULT",U.ALLOW_ALL="ALLOW_ALL",(k=eG||(eG={})).auto="auto",k.en="en",k.ja="ja",k.ko="ko",k.hi="hi",k.zh="zh",k.pt="pt",k.es="es",(q=eL||(eL={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",q.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",q.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",q.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",q.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(G=eF||(eF={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",G.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",G.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",G.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(L=eH||(eH={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",L.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",L.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",L.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(F=ej||(ej={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",F.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",F.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",F.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",F.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",F.EDIT_MODE_STYLE="EDIT_MODE_STYLE",F.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",F.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(H=eV||(eV={})).FOREGROUND="FOREGROUND",H.BACKGROUND="BACKGROUND",H.PROMPT="PROMPT",H.SEMANTIC="SEMANTIC",H.INTERACTIVE="INTERACTIVE",(j=eB||(eB={})).ASSET="ASSET",j.STYLE="STYLE",(V=eJ||(eJ={})).INSERT="INSERT",V.REMOVE="REMOVE",V.REMOVE_STATIC="REMOVE_STATIC",V.OUTPAINT="OUTPAINT",(B=eY||(eY={})).OPTIMIZED="OPTIMIZED",B.LOSSLESS="LOSSLESS",(J=eK||(eK={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",J.PREFERENCE_TUNING="PREFERENCE_TUNING",(Y=eW||(eW={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",Y.STATE_PENDING="STATE_PENDING",Y.STATE_ACTIVE="STATE_ACTIVE",Y.STATE_FAILED="STATE_FAILED",(K=e$||(e$={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",K.PROCESSING="PROCESSING",K.ACTIVE="ACTIVE",K.FAILED="FAILED",(W=ez||(ez={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",W.UPLOADED="UPLOADED",W.GENERATED="GENERATED",($=eX||(eX={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",$.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",$.RESPONSE_REJECTED="RESPONSE_REJECTED",$.NEED_MORE_INPUT="NEED_MORE_INPUT",(z=eQ||(eQ={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",z.TEXT="TEXT",z.IMAGE="IMAGE",z.VIDEO="VIDEO",z.AUDIO="AUDIO",z.DOCUMENT="DOCUMENT",(X=eZ||(eZ={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",X.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",X.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(Q=e0||(e0={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",Q.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",Q.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(Z=e1||(e1={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",Z.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",Z.NO_INTERRUPTION="NO_INTERRUPTION",(ee=e2||(e2={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",ee.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",ee.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(et=e4||(e4={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",et.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",et.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",et.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",et.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",et.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",et.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",et.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",et.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",et.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",et.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",et.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",et.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(en=e5||(e5={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",en.QUALITY="QUALITY",en.DIVERSITY="DIVERSITY",en.VOCALIZATION="VOCALIZATION",(ei=e3||(e3={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",ei.PLAY="PLAY",ei.PAUSE="PAUSE",ei.STOP="STOP",ei.RESET_CONTEXT="RESET_CONTEXT";class ta{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class ts{get text(){var e,t,n,i,l,r,o,a;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let s="",u=!1,p=[];for(let e of null!=(a=null==(o=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:o.parts)?a:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&"thoughtSignature"!==t&&(null!==n||void 0!==n)&&p.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,s+=e.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?s:void 0}get data(){var e,t,n,i,l,r,o,a;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let s="",u=[];for(let e of null!=(a=null==(o=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:o.parts)?a:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(s+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}get functionCalls(){var e,t,n,i,l,r,o,a;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let s=null==(a=null==(o=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:o.parts)?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==s?void 0:s.length)!==0)return s}get executableCode(){var e,t,n,i,l,r,o,a,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null==(a=null==(o=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:o.parts)?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(s=null==u?void 0:u[0])?void 0:s.code}get codeExecutionResult(){var e,t,n,i,l,r,o,a,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null==(a=null==(o=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:o.parts)?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(s=null==u?void 0:u[0])?void 0:s.output}}class tu{}class tp{}class td{}class tc{}class th{}class tm{}class tf{}class tg{}class ty{}class tE{}class t_{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n,i=new t_;if(t){let t,i,l,r,o,a;t={},null!=(i=tl(e,["name"]))&&ti(t,["name"],i),null!=(l=tl(e,["metadata"]))&&ti(t,["metadata"],l),null!=(r=tl(e,["done"]))&&ti(t,["done"],r),null!=(o=tl(e,["error"]))&&ti(t,["error"],o),null!=(a=tl(e,["response"]))&&ti(t,["response"],function(e){let t={},n=tl(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a;return n={},null!=(i=tl(e,["_self"]))&&ti(n,["video"],(l={},null!=(r=tl(t=i,["gcsUri"]))&&ti(l,["uri"],r),null!=(o=tl(t,["bytesBase64Encoded"]))&&ti(l,["videoBytes"],tr(o)),null!=(a=tl(t,["mimeType"]))&&ti(l,["mimeType"],a),l)),n})),ti(t,["generatedVideos"],e)}let i=tl(e,["raiMediaFilteredCount"]);null!=i&&ti(t,["raiMediaFilteredCount"],i);let l=tl(e,["raiMediaFilteredReasons"]);return null!=l&&ti(t,["raiMediaFilteredReasons"],l),t}(a)),n=t}else{let t,i,l,r,o,a;t={},null!=(i=tl(e,["name"]))&&ti(t,["name"],i),null!=(l=tl(e,["metadata"]))&&ti(t,["metadata"],l),null!=(r=tl(e,["done"]))&&ti(t,["done"],r),null!=(o=tl(e,["error"]))&&ti(t,["error"],o),null!=(a=tl(e,["response","generateVideoResponse"]))&&ti(t,["response"],function(e){let t={},n=tl(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a;return n={},null!=(i=tl(e,["video"]))&&ti(n,["video"],(l={},null!=(r=tl(t=i,["uri"]))&&ti(l,["uri"],r),null!=(o=tl(t,["encodedVideo"]))&&ti(l,["videoBytes"],tr(o)),null!=(a=tl(t,["encoding"]))&&ti(l,["mimeType"],a),l)),n})),ti(t,["generatedVideos"],e)}let i=tl(e,["raiMediaFilteredCount"]);null!=i&&ti(t,["raiMediaFilteredCount"],i);let l=tl(e,["raiMediaFilteredReasons"]);return null!=l&&ti(t,["raiMediaFilteredReasons"],l),t}(a)),n=t}return Object.assign(i,n),i}}class tT{}class tv{}class tI{}class tA{}class tC{}class tS{}class tO{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){var n;let i,l,r,o,a,s,u,p,d,c,h=new tO;return Object.assign(h,(a={},null!=(s=tl(e,["name"]))&&ti(a,["name"],s),null!=(u=tl(e,["metadata"]))&&ti(a,["metadata"],u),null!=(p=tl(e,["done"]))&&ti(a,["done"],p),null!=(d=tl(e,["error"]))&&ti(a,["error"],d),null!=(c=tl(e,["response"]))&&ti(a,["response"],(i={},null!=(l=tl(n=c,["sdkHttpResponse"]))&&ti(i,["sdkHttpResponse"],l),null!=(r=tl(n,["parent"]))&&ti(i,["parent"],r),null!=(o=tl(n,["documentName"]))&&ti(i,["documentName"],o),i)),a)),h}}class tb{}class tN{}class tR{}class tP{}class tM{get text(){var e,t,n;let i="",l=!1,r=[];for(let o of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(o))"text"!==e&&"thought"!==e&&null!==t&&r.push(e);if("string"==typeof o.text){if("boolean"==typeof o.thought&&o.thought)continue;l=!0,i+=o.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?i:void 0}get data(){var e,t,n;let i="",l=[];for(let r of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(r))"inlineData"!==e&&null!==t&&l.push(e);r.inlineData&&"string"==typeof r.inlineData.data&&(i+=atob(r.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class tD{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class tw{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new tw;return Object.assign(n,to(e)),n}}function tx(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw Error("invalid model parameter");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function tU(e,t){let n=tx(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function tk(e){return Array.isArray(e)?e.map(e=>tq(e)):[tq(e)]}function tq(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function tG(e){let t=tq(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tL(e){let t=tq(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tF(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function tH(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>tF(e)):[tF(e)]}function tj(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function tV(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function tB(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function tJ(e){if(null==e)throw Error("ContentUnion is required");return tj(e)?e:{role:"user",parts:tH(e)}}function tY(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=tJ(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=tJ(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>tJ(e)):[tJ(t)]}function tK(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(tV(e)||tB(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[tJ(e)]}let t=[],n=[],i=tj(e[0]);for(let l of e){let e=tj(l);if(e!=i)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(l);else if(tV(l)||tB(l))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(l)}return i||t.push({role:"user",parts:tH(n)}),t}function tW(e){let t={},n=["items"],i=["anyOf"],l=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let r=e.anyOf;for(let[o,a]of(null!=r&&2==r.length&&("null"===r[0].type?(t.nullable=!0,e=r[1]):"null"===r[1].type&&(t.nullable=!0,e=r[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(es).includes(n[0].toUpperCase())?n[0].toUpperCase():es.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(es).includes(e.toUpperCase())?e.toUpperCase():es.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a)if("type"==o){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(es).includes(a.toUpperCase())?a.toUpperCase():es.TYPE_UNSPECIFIED}else if(n.includes(o))t[o]=tW(a);else if(i.includes(o)){let e=[];for(let n of a){if("null"==n.type){t.nullable=!0;continue}e.push(tW(n))}t[o]=e}else if(l.includes(o)){let e={};for(let[t,n]of Object.entries(a))e[t]=tW(n);t[o]=e}else{if("additionalProperties"===o)continue;t[o]=a}return t}function t$(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function tz(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function tX(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=tW(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=tW(t.response));return e}function tQ(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function tZ(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,i=1){let l=!t.startsWith(`${n}/`)&&t.split("/").length===i;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${n}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(l)return`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`;else return t;return l?`${n}/${t}`:t}(e,t,"cachedContents")}function t0(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function t1(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),null==e||"object"!=typeof e||!("uri"in e)||void 0!==(n=e.uri)){if(null==e||"object"!=typeof e||!("video"in e)||void 0!==(n=null==(t=e.video)?void 0:t.uri)){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}}function t2(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function t4(e){for(let i of["models","tunedModels","publisherModels"]){var t,n;if(t=e,n=i,null!==t&&"object"==typeof t&&n in t)return e[i]}return[]}function t5(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let i=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,l=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(l>0||1!==i)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||1!==l)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function t3(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let i=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function t6(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function t8(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function t7(e){let t={},n=tl(e,["name"]);null!=n&&ti(t,["name"],n);let i=tl(e,["metadata","displayName"]);null!=i&&ti(t,["displayName"],i);let l=tl(e,["metadata","state"]);null!=l&&ti(t,["state"],t8(l));let r=tl(e,["metadata","createTime"]);null!=r&&ti(t,["createTime"],r);let o=tl(e,["metadata","endTime"]);null!=o&&ti(t,["endTime"],o);let a=tl(e,["metadata","updateTime"]);null!=a&&ti(t,["updateTime"],a);let s=tl(e,["metadata","model"]);null!=s&&ti(t,["model"],s);let u=tl(e,["metadata","output"]);return null!=u&&ti(t,["dest"],function(e){let t={},n=tl(e,["responsesFile"]);null!=n&&ti(t,["fileName"],n);let i=tl(e,["inlinedResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l;return n={},null!=(i=tl(t=e,["response"]))&&ti(n,["response"],function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["content"]);null!=n&&ti(t,["content"],n);let i=tl(e,["citationMetadata"]);null!=i&&ti(t,["citationMetadata"],function(e){let t={},n=tl(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["citations"],e)}return t}(i));let l=tl(e,["tokenCount"]);null!=l&&ti(t,["tokenCount"],l);let r=tl(e,["finishReason"]);null!=r&&ti(t,["finishReason"],r);let o=tl(e,["avgLogprobs"]);null!=o&&ti(t,["avgLogprobs"],o);let a=tl(e,["groundingMetadata"]);null!=a&&ti(t,["groundingMetadata"],a);let s=tl(e,["index"]);null!=s&&ti(t,["index"],s);let u=tl(e,["logprobsResult"]);null!=u&&ti(t,["logprobsResult"],u);let p=tl(e,["safetyRatings"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["safetyRatings"],e)}let d=tl(e,["urlContextMetadata"]);return null!=d&&ti(t,["urlContextMetadata"],d),t})(e))),ti(t,["candidates"],e)}let l=tl(e,["modelVersion"]);null!=l&&ti(t,["modelVersion"],l);let r=tl(e,["promptFeedback"]);null!=r&&ti(t,["promptFeedback"],r);let o=tl(e,["responseId"]);null!=o&&ti(t,["responseId"],o);let a=tl(e,["usageMetadata"]);return null!=a&&ti(t,["usageMetadata"],a),t}(i)),null!=(l=tl(t,["error"]))&&ti(n,["error"],l),n})),ti(t,["inlinedResponses"],e)}let l=tl(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["inlinedEmbedContentResponses"],e)}return t}(t3(u))),t}function t9(e){var t,n;let i,l,r,o,a,s,u,p,d={},c=tl(e,["name"]);null!=c&&ti(d,["name"],c);let h=tl(e,["displayName"]);null!=h&&ti(d,["displayName"],h);let m=tl(e,["state"]);null!=m&&ti(d,["state"],t8(m));let f=tl(e,["error"]);null!=f&&ti(d,["error"],f);let g=tl(e,["createTime"]);null!=g&&ti(d,["createTime"],g);let y=tl(e,["startTime"]);null!=y&&ti(d,["startTime"],y);let E=tl(e,["endTime"]);null!=E&&ti(d,["endTime"],E);let _=tl(e,["updateTime"]);null!=_&&ti(d,["updateTime"],_);let T=tl(e,["model"]);null!=T&&ti(d,["model"],T);let v=tl(e,["inputConfig"]);null!=v&&ti(d,["src"],(i={},null!=(l=tl(n=v,["instancesFormat"]))&&ti(i,["format"],l),null!=(r=tl(n,["gcsSource","uris"]))&&ti(i,["gcsUri"],r),null!=(o=tl(n,["bigquerySource","inputUri"]))&&ti(i,["bigqueryUri"],o),i));let I=tl(e,["outputConfig"]);null!=I&&ti(d,["dest"],(t=t3(I),a={},null!=(s=tl(t,["predictionsFormat"]))&&ti(a,["format"],s),null!=(u=tl(t,["gcsDestination","outputUriPrefix"]))&&ti(a,["gcsUri"],u),null!=(p=tl(t,["bigqueryDestination","outputUri"]))&&ti(a,["bigqueryUri"],p),a));let A=tl(e,["completionStats"]);return null!=A&&ti(d,["completionStats"],A),d}function ne(e){let t={},n=tl(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a,s,u,p,d,c,h;return n={},null!=(i=tl(t=e,["mediaResolution"]))&&ti(n,["mediaResolution"],i),null!=(l=tl(t,["codeExecutionResult"]))&&ti(n,["codeExecutionResult"],l),null!=(r=tl(t,["executableCode"]))&&ti(n,["executableCode"],r),null!=(o=tl(t,["fileData"]))&&ti(n,["fileData"],function(e){let t={};if(void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=tl(e,["fileUri"]);null!=n&&ti(t,["fileUri"],n);let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(o)),null!=(a=tl(t,["functionCall"]))&&ti(n,["functionCall"],function(e){let t={},n=tl(e,["id"]);null!=n&&ti(t,["id"],n);let i=tl(e,["args"]);null!=i&&ti(t,["args"],i);let l=tl(e,["name"]);if(null!=l&&ti(t,["name"],l),void 0!==tl(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==tl(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(a)),null!=(s=tl(t,["functionResponse"]))&&ti(n,["functionResponse"],s),null!=(u=tl(t,["inlineData"]))&&ti(n,["inlineData"],function(e){let t={},n=tl(e,["data"]);if(null!=n&&ti(t,["data"],n),void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(u)),null!=(p=tl(t,["text"]))&&ti(n,["text"],p),null!=(d=tl(t,["thought"]))&&ti(n,["thought"],d),null!=(c=tl(t,["thoughtSignature"]))&&ti(n,["thoughtSignature"],c),null!=(h=tl(t,["videoMetadata"]))&&ti(n,["videoMetadata"],h),n})),ti(t,["parts"],e)}let i=tl(e,["role"]);return null!=i&&ti(t,["role"],i),t}function nt(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["_url","model"],tx(e,i));let l=tl(t,["src"]);null!=l&&ti(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==tl(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==tl(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==tl(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let i=tl(t,["fileName"]);null!=i&&ti(n,["fileName"],i);let l=tl(t,["inlinedRequests"]);if(null!=l){let t=l;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["request","model"],tx(e,i));let l=tl(t,["contents"]);if(null!=l){let e=tK(l);Array.isArray(e)&&(e=e.map(e=>ne(e))),ti(n,["request","contents"],e)}let r=tl(t,["metadata"]);null!=r&&ti(n,["metadata"],r);let o=tl(t,["config"]);return null!=o&&ti(n,["request","generationConfig"],function(e,t,n){var i;let l,r,o,a={},s=tl(t,["systemInstruction"]);void 0!==n&&null!=s&&ti(n,["systemInstruction"],ne(tJ(s)));let u=tl(t,["temperature"]);null!=u&&ti(a,["temperature"],u);let p=tl(t,["topP"]);null!=p&&ti(a,["topP"],p);let d=tl(t,["topK"]);null!=d&&ti(a,["topK"],d);let c=tl(t,["candidateCount"]);null!=c&&ti(a,["candidateCount"],c);let h=tl(t,["maxOutputTokens"]);null!=h&&ti(a,["maxOutputTokens"],h);let m=tl(t,["stopSequences"]);null!=m&&ti(a,["stopSequences"],m);let f=tl(t,["responseLogprobs"]);null!=f&&ti(a,["responseLogprobs"],f);let g=tl(t,["logprobs"]);null!=g&&ti(a,["logprobs"],g);let y=tl(t,["presencePenalty"]);null!=y&&ti(a,["presencePenalty"],y);let E=tl(t,["frequencyPenalty"]);null!=E&&ti(a,["frequencyPenalty"],E);let _=tl(t,["seed"]);null!=_&&ti(a,["seed"],_);let T=tl(t,["responseMimeType"]);null!=T&&ti(a,["responseMimeType"],T);let v=tl(t,["responseSchema"]);null!=v&&ti(a,["responseSchema"],tW(v));let I=tl(t,["responseJsonSchema"]);if(null!=I&&ti(a,["responseJsonSchema"],I),void 0!==tl(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==tl(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let A=tl(t,["safetySettings"]);if(void 0!==n&&null!=A){let e=A;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["category"]);if(null!=n&&ti(t,["category"],n),void 0!==tl(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let i=tl(e,["threshold"]);return null!=i&&ti(t,["threshold"],i),t})(e))),ti(n,["safetySettings"],e)}let C=tl(t,["tools"]);if(void 0!==n&&null!=C){let e=tQ(C);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["functionDeclarations"],e)}if(void 0!==tl(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tl(e,["googleSearchRetrieval"]);null!=i&&ti(t,["googleSearchRetrieval"],i);let l=tl(e,["computerUse"]);null!=l&&ti(t,["computerUse"],l);let r=tl(e,["fileSearch"]);null!=r&&ti(t,["fileSearch"],r);let o=tl(e,["codeExecution"]);if(null!=o&&ti(t,["codeExecution"],o),void 0!==tl(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=tl(e,["googleMaps"]);null!=a&&ti(t,["googleMaps"],function(e){let t={};if(void 0!==tl(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=tl(e,["enableWidget"]);return null!=n&&ti(t,["enableWidget"],n),t}(a));let s=tl(e,["googleSearch"]);null!=s&&ti(t,["googleSearch"],function(e){let t={};if(void 0!==tl(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==tl(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=tl(e,["timeRangeFilter"]);return null!=n&&ti(t,["timeRangeFilter"],n),t}(s));let u=tl(e,["urlContext"]);return null!=u&&ti(t,["urlContext"],u),t})(tX(e)))),ti(n,["tools"],e)}let S=tl(t,["toolConfig"]);if(void 0!==n&&null!=S&&ti(n,["toolConfig"],(l={},null!=(r=tl(i=S,["functionCallingConfig"]))&&ti(l,["functionCallingConfig"],function(e){let t={},n=tl(e,["mode"]);null!=n&&ti(t,["mode"],n);let i=tl(e,["allowedFunctionNames"]);if(null!=i&&ti(t,["allowedFunctionNames"],i),void 0!==tl(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(r)),null!=(o=tl(i,["retrievalConfig"]))&&ti(l,["retrievalConfig"],o),l)),void 0!==tl(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let O=tl(t,["cachedContent"]);void 0!==n&&null!=O&&ti(n,["cachedContent"],tZ(e,O));let b=tl(t,["responseModalities"]);null!=b&&ti(a,["responseModalities"],b);let N=tl(t,["mediaResolution"]);null!=N&&ti(a,["mediaResolution"],N);let R=tl(t,["speechConfig"]);if(null!=R&&ti(a,["speechConfig"],t$(R)),void 0!==tl(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let P=tl(t,["thinkingConfig"]);null!=P&&ti(a,["thinkingConfig"],P);let M=tl(t,["imageConfig"]);return null!=M&&ti(a,["imageConfig"],function(e){let t={},n=tl(e,["aspectRatio"]);null!=n&&ti(t,["aspectRatio"],n);let i=tl(e,["imageSize"]);if(null!=i&&ti(t,["imageSize"],i),void 0!==tl(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==tl(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(M)),a}(e,o,tl(n,["request"],{}))),n})(e,t))),ti(n,["requests","requests"],t)}return n}(e,t5(e,l)));let r=tl(t,["config"]);return null!=r&&function(e,t){let n=tl(e,["displayName"]);if(void 0!==t&&null!=n&&ti(t,["batch","displayName"],n),void 0!==tl(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(r,n),n}(el=e6||(e6={})).PAGED_ITEM_BATCH_JOBS="batchJobs",el.PAGED_ITEM_MODELS="models",el.PAGED_ITEM_TUNING_JOBS="tuningJobs",el.PAGED_ITEM_FILES="files",el.PAGED_ITEM_CACHED_CONTENTS="cachedContents",el.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",el.PAGED_ITEM_DOCUMENTS="documents";class nn{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,l;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let r={config:{}};(r=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(r.config.pageToken=t.nextPageToken),this.paramsInternal=r,this.pageInternalSize=null!=(l=null==(i=r.config)?void 0:i.pageSize)?l:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class ni extends tt{constructor(e){super(),this.apiClient=e,this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)},this.list=async(e={})=>new nn(e6.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e)}createInlinedGenerateContentRequest(e){let t=nt(this.apiClient,e),n=tn("{model}:batchGenerateContent",t._url),i=t.batch.inputConfig.requests,l=i.requests,r=[];for(let e of l){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}r.push(t)}return i.requests=r,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),void 0===n.dest){let t=this.getGcsUri(e),l=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${i}`;else if(l)n.dest=`${l}_dest_${i}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,i,l,r;let o="",a={};if(this.apiClient.isVertexAI()){let i,l,s,u,p,d,c=(r=this.apiClient,i={},null!=(l=tl(e,["model"]))&&ti(i,["model"],tx(r,l)),null!=(s=tl(e,["src"]))&&ti(i,["inputConfig"],function(e){let t={},n=tl(e,["format"]);null!=n&&ti(t,["instancesFormat"],n);let i=tl(e,["gcsUri"]);null!=i&&ti(t,["gcsSource","uris"],i);let l=tl(e,["bigqueryUri"]);if(null!=l&&ti(t,["bigquerySource","inputUri"],l),void 0!==tl(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==tl(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(t5(r,s))),null!=(u=tl(e,["config"]))&&(p=tl(u,["displayName"]),void 0!==i&&null!=p&&ti(i,["displayName"],p),d=tl(u,["dest"]),void 0!==i&&null!=d&&ti(i,["outputConfig"],function(e){let t={},n=tl(e,["format"]);null!=n&&ti(t,["predictionsFormat"],n);let i=tl(e,["gcsUri"]);null!=i&&ti(t,["gcsDestination","outputUriPrefix"],i);let l=tl(e,["bigqueryUri"]);if(null!=l&&ti(t,["bigqueryDestination","outputUri"],l),void 0!==tl(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==tl(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==tl(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(d)))),i);return o=tn("batchPredictionJobs",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>t9(e))}{let t=nt(this.apiClient,e);return o=tn("{model}:batchGenerateContent",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>t7(e))}}async createEmbeddingsInternal(e){var t,n,i,l,r;let o="",a={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,u,p,d,c,h,m,f,g=(i=this.apiClient,d={},null!=(c=tl(e,["model"]))&&ti(d,["_url","model"],tx(i,c)),null!=(h=tl(e,["src"]))&&ti(d,["batch","inputConfig"],(l=i,s={},null!=(u=tl(r=h,["fileName"]))&&ti(s,["file_name"],u),null!=(p=tl(r,["inlinedRequests"]))&&ti(s,["requests"],function(e,t){let n={},i=tl(t,["contents"]);if(null!=i){let t=tY(e,i);Array.isArray(t)&&(t=t.map(e=>e)),ti(n,["requests[]","request","content"],t)}let l=tl(t,["config"]);return null!=l&&(ti(n,["_self"],function(e,t){let n=tl(e,["taskType"]);void 0!==t&&null!=n&&ti(t,["requests[]","taskType"],n);let i=tl(e,["title"]);void 0!==t&&null!=i&&ti(t,["requests[]","title"],i);let l=tl(e,["outputDimensionality"]);if(void 0!==t&&null!=l&&ti(t,["requests[]","outputDimensionality"],l),void 0!==tl(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==tl(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(l,n)),!function(e,t){for(let[n,i]of Object.entries(t)){let t=n.split("."),l=i.split("."),r=new Set,o=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){o=e;break}if(-1!==o&&l.length>o)for(let e=o;e<l.length;e++){let t=l[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||r.add(t)}!function e(t,n,i,l,r){if(l>=n.length||"object"!=typeof t||null===t)return;let o=n[l];if(o.endsWith("[]")){let a=o.slice(0,-2);if(a in t&&Array.isArray(t[a]))for(let o of t[a])e(o,n,i,l+1,r)}else if("*"===o){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!r.has(e)),n={};for(let i of e)n[i]=t[i];for(let[e,r]of Object.entries(n)){let n=[];for(let t of i.slice(l))"*"===t?n.push(e):n.push(t);ti(t,n,r)}for(let n of e)delete t[n]}}else o in t&&e(t[o],n,i,l+1,r)}(e,t,l,0,r)}}(n,{"requests[].*":"requests[].request.*"})),n}(l,p)),s)),null!=(m=tl(e,["config"]))&&(f=tl(m,["displayName"]),void 0!==d&&null!=f&&ti(d,["batch","displayName"],f)),d);return o=tn("{model}:asyncBatchEmbedContent",g._url),a=g._query,delete g._url,delete g._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(g),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>t7(e))}}async get(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o=(r=this.apiClient,i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],t6(r,l)),i);return a=tn("batchPredictionJobs/{name}",o._url),s=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>t9(e))}{let t,n,r=(o=this.apiClient,t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],t6(o,n)),t);return a=tn("batches/{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>t7(e))}}async cancel(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o=(r=this.apiClient,i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],t6(r,l)),i);a=tn("batchPredictionJobs/{name}:cancel",o._url),s=o._query,delete o._url,delete o._query,await this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,r=(o=this.apiClient,t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],t6(o,n)),t);a=tn("batches/{name}:cancel",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal})}}async listInternal(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i,l,a,s,u,p=(i={},null!=(l=tl(e,["config"]))&&(a=tl(l,["pageSize"]),void 0!==i&&null!=a&&ti(i,["_query","pageSize"],a),s=tl(l,["pageToken"]),void 0!==i&&null!=s&&ti(i,["_query","pageToken"],s),u=tl(l,["filter"]),void 0!==i&&null!=u&&ti(i,["_query","filter"],u)),i);return r=tn("batchPredictionJobs",p._url),o=p._query,delete p._url,delete p._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["batchPredictionJobs"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>t9(e))),ti(t,["batchJobs"],e)}return t}(e),n=new tP;return Object.assign(n,t),n})}{let t,n,a=(t={},null!=(n=tl(e,["config"]))&&function(e,t){let n=tl(e,["pageSize"]);void 0!==t&&null!=n&&ti(t,["_query","pageSize"],n);let i=tl(e,["pageToken"]);if(void 0!==t&&null!=i&&ti(t,["_query","pageToken"],i),void 0!==tl(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t);return r=tn("batches",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["operations"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>t7(e))),ti(t,["batchJobs"],e)}return t}(e),n=new tP;return Object.assign(n,t),n})}}async delete(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o=(r=this.apiClient,i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],t6(r,l)),i);return a=tn("batchPredictionJobs/{name}",o._url),s=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r;return t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),null!=(i=tl(e,["name"]))&&ti(t,["name"],i),null!=(l=tl(e,["done"]))&&ti(t,["done"],l),null!=(r=tl(e,["error"]))&&ti(t,["error"],r),t})}{let t,n,r=(o=this.apiClient,t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],t6(o,n)),t);return a=tn("batches/{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r;return t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),null!=(i=tl(e,["name"]))&&ti(t,["name"],i),null!=(l=tl(e,["done"]))&&ti(t,["done"],l),null!=(r=tl(e,["error"]))&&ti(t,["error"],r),t})}}}function nl(e){let t={},n=tl(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a,s,u,p,d,c,h;return n={},null!=(i=tl(t=e,["mediaResolution"]))&&ti(n,["mediaResolution"],i),null!=(l=tl(t,["codeExecutionResult"]))&&ti(n,["codeExecutionResult"],l),null!=(r=tl(t,["executableCode"]))&&ti(n,["executableCode"],r),null!=(o=tl(t,["fileData"]))&&ti(n,["fileData"],function(e){let t={};if(void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=tl(e,["fileUri"]);null!=n&&ti(t,["fileUri"],n);let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(o)),null!=(a=tl(t,["functionCall"]))&&ti(n,["functionCall"],function(e){let t={},n=tl(e,["id"]);null!=n&&ti(t,["id"],n);let i=tl(e,["args"]);null!=i&&ti(t,["args"],i);let l=tl(e,["name"]);if(null!=l&&ti(t,["name"],l),void 0!==tl(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==tl(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(a)),null!=(s=tl(t,["functionResponse"]))&&ti(n,["functionResponse"],s),null!=(u=tl(t,["inlineData"]))&&ti(n,["inlineData"],function(e){let t={},n=tl(e,["data"]);if(null!=n&&ti(t,["data"],n),void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(u)),null!=(p=tl(t,["text"]))&&ti(n,["text"],p),null!=(d=tl(t,["thought"]))&&ti(n,["thought"],d),null!=(c=tl(t,["thoughtSignature"]))&&ti(n,["thoughtSignature"],c),null!=(h=tl(t,["videoMetadata"]))&&ti(n,["videoMetadata"],h),n})),ti(t,["parts"],e)}let i=tl(e,["role"]);return null!=i&&ti(t,["role"],i),t}class nr extends tt{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nn(e6.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o,u=(r=this.apiClient,i={},null!=(l=tl(e,["model"]))&&ti(i,["model"],tU(r,l)),null!=(o=tl(e,["config"]))&&function(e,t){let n=tl(e,["ttl"]);void 0!==t&&null!=n&&ti(t,["ttl"],n);let i=tl(e,["expireTime"]);void 0!==t&&null!=i&&ti(t,["expireTime"],i);let l=tl(e,["displayName"]);void 0!==t&&null!=l&&ti(t,["displayName"],l);let r=tl(e,["contents"]);if(void 0!==t&&null!=r){let e=tK(r);Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["contents"],e)}let o=tl(e,["systemInstruction"]);void 0!==t&&null!=o&&ti(t,["systemInstruction"],tJ(o));let a=tl(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==tl(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=tl(e,["description"]);null!=n&&ti(t,["description"],n);let i=tl(e,["name"]);null!=i&&ti(t,["name"],i);let l=tl(e,["parameters"]);null!=l&&ti(t,["parameters"],l);let r=tl(e,["parametersJsonSchema"]);null!=r&&ti(t,["parametersJsonSchema"],r);let o=tl(e,["response"]);null!=o&&ti(t,["response"],o);let a=tl(e,["responseJsonSchema"]);return null!=a&&ti(t,["responseJsonSchema"],a),t})(e))),ti(t,["functionDeclarations"],e)}let i=tl(e,["retrieval"]);null!=i&&ti(t,["retrieval"],i);let l=tl(e,["googleSearchRetrieval"]);null!=l&&ti(t,["googleSearchRetrieval"],l);let r=tl(e,["computerUse"]);if(null!=r&&ti(t,["computerUse"],r),void 0!==tl(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let o=tl(e,["codeExecution"]);null!=o&&ti(t,["codeExecution"],o);let a=tl(e,["enterpriseWebSearch"]);null!=a&&ti(t,["enterpriseWebSearch"],a);let s=tl(e,["googleMaps"]);null!=s&&ti(t,["googleMaps"],s);let u=tl(e,["googleSearch"]);null!=u&&ti(t,["googleSearch"],u);let p=tl(e,["urlContext"]);return null!=p&&ti(t,["urlContext"],p),t})(e))),ti(t,["tools"],e)}let s=tl(e,["toolConfig"]);void 0!==t&&null!=s&&ti(t,["toolConfig"],s);let u=tl(e,["kmsKeyName"]);void 0!==t&&null!=u&&ti(t,["encryption_spec","kmsKeyName"],u)}(o,i),i);return a=tn("cachedContents",u._url),s=u._query,delete u._url,delete u._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,r,u=(o=this.apiClient,t={},null!=(n=tl(e,["model"]))&&ti(t,["model"],tU(o,n)),null!=(r=tl(e,["config"]))&&function(e,t){var n;let i,l,r,o=tl(e,["ttl"]);void 0!==t&&null!=o&&ti(t,["ttl"],o);let a=tl(e,["expireTime"]);void 0!==t&&null!=a&&ti(t,["expireTime"],a);let s=tl(e,["displayName"]);void 0!==t&&null!=s&&ti(t,["displayName"],s);let u=tl(e,["contents"]);if(void 0!==t&&null!=u){let e=tK(u);Array.isArray(e)&&(e=e.map(e=>nl(e))),ti(t,["contents"],e)}let p=tl(e,["systemInstruction"]);void 0!==t&&null!=p&&ti(t,["systemInstruction"],nl(tJ(p)));let d=tl(e,["tools"]);if(void 0!==t&&null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["functionDeclarations"],e)}if(void 0!==tl(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tl(e,["googleSearchRetrieval"]);null!=i&&ti(t,["googleSearchRetrieval"],i);let l=tl(e,["computerUse"]);null!=l&&ti(t,["computerUse"],l);let r=tl(e,["fileSearch"]);null!=r&&ti(t,["fileSearch"],r);let o=tl(e,["codeExecution"]);if(null!=o&&ti(t,["codeExecution"],o),void 0!==tl(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=tl(e,["googleMaps"]);null!=a&&ti(t,["googleMaps"],function(e){let t={};if(void 0!==tl(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=tl(e,["enableWidget"]);return null!=n&&ti(t,["enableWidget"],n),t}(a));let s=tl(e,["googleSearch"]);null!=s&&ti(t,["googleSearch"],function(e){let t={};if(void 0!==tl(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==tl(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=tl(e,["timeRangeFilter"]);return null!=n&&ti(t,["timeRangeFilter"],n),t}(s));let u=tl(e,["urlContext"]);return null!=u&&ti(t,["urlContext"],u),t})(e))),ti(t,["tools"],e)}let c=tl(e,["toolConfig"]);if(void 0!==t&&null!=c&&ti(t,["toolConfig"],(i={},null!=(l=tl(n=c,["functionCallingConfig"]))&&ti(i,["functionCallingConfig"],function(e){let t={},n=tl(e,["mode"]);null!=n&&ti(t,["mode"],n);let i=tl(e,["allowedFunctionNames"]);if(null!=i&&ti(t,["allowedFunctionNames"],i),void 0!==tl(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(l)),null!=(r=tl(n,["retrievalConfig"]))&&ti(i,["retrievalConfig"],r),i)),void 0!==tl(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(r,t),t);return a=tn("cachedContents",u._url),s=u._query,delete u._url,delete u._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o=(r=this.apiClient,i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],tZ(r,l)),i);return a=tn("{name}",o._url),s=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,r=(o=this.apiClient,t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],tZ(o,n)),t);return a=tn("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o=(r=this.apiClient,i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],tZ(r,l)),i);return a=tn("{name}",o._url),s=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),t),l=new tv;return Object.assign(l,i),l})}{let t,n,r=(o=this.apiClient,t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],tZ(o,n)),t);return a=tn("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),t),l=new tv;return Object.assign(l,i),l})}}async update(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o,u,p,d=(r=this.apiClient,i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],tZ(r,l)),null!=(o=tl(e,["config"]))&&(u=tl(o,["ttl"]),void 0!==i&&null!=u&&ti(i,["ttl"],u),p=tl(o,["expireTime"]),void 0!==i&&null!=p&&ti(i,["expireTime"],p)),i);return a=tn("{name}",d._url),s=d._query,delete d._url,delete d._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,r,u,p,d=(o=this.apiClient,t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],tZ(o,n)),null!=(r=tl(e,["config"]))&&(u=tl(r,["ttl"]),void 0!==t&&null!=u&&ti(t,["ttl"],u),p=tl(r,["expireTime"]),void 0!==t&&null!=p&&ti(t,["expireTime"],p)),t);return a=tn("{name}",d._url),s=d._query,delete d._url,delete d._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i,l,a,s,u=(i={},null!=(l=tl(e,["config"]))&&(a=tl(l,["pageSize"]),void 0!==i&&null!=a&&ti(i,["_query","pageSize"],a),s=tl(l,["pageToken"]),void 0!==i&&null!=s&&ti(i,["_query","pageToken"],s)),i);return r=tn("cachedContents",u._url),o=u._query,delete u._url,delete u._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["cachedContents"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["cachedContents"],e)}return t}(e),n=new tI;return Object.assign(n,t),n})}{let t,n,a,s,u=(t={},null!=(n=tl(e,["config"]))&&(a=tl(n,["pageSize"]),void 0!==t&&null!=a&&ti(t,["_query","pageSize"],a),s=tl(n,["pageToken"]),void 0!==t&&null!=s&&ti(t,["_query","pageToken"],s)),t);return r=tn("cachedContents",u._url),o=u._query,delete u._url,delete u._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["cachedContents"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["cachedContents"],e)}return t}(e),n=new tI;return Object.assign(n,t),n})}}}function no(e){return this instanceof no?(this.v=e,this):new no(e)}function na(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,l=n.apply(e,t||[]),r=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),i[Symbol.asyncIterator]=function(){return this},i;function o(e,t){l[e]&&(i[e]=function(t){return new Promise(function(n,i){r.push([e,t,n,i])>1||a(e,t)})},t&&(i[e]=t(i[e])))}function a(e,t){try{var n;(n=l[e](t)).value instanceof no?Promise.resolve(n.value.v).then(s,u):p(r[0][2],n)}catch(e){p(r[0][3],e)}}function s(e){a("next",e)}function u(e){a("throw",e)}function p(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}function ns(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,l){var r,o,a;r=i,o=l,a=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){r({value:e,done:a})},o)})}}}function nu(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function np(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,i=0;for(;i<n;)if("user"===e[i].role)t.push(e[i]),i++;else{let l=[],r=!0;for(;i<n&&"model"===e[i].role;)l.push(e[i]),r&&!nu(e[i])&&(r=!1),i++;r?t.push(...l):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class nd{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new nc(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class nc{constructor(e,t,n,i={},l=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(l)}async sendMessage(e){var t;await this.sendPromise;let n=tJ(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,l;let r=await i,o=null==(t=null==(e=r.candidates)?void 0:e[0])?void 0:t.content,a=r.automaticFunctionCallingHistory,s=this.getHistory(!0).length,u=[];null!=a&&(u=null!=(l=a.slice(s))?l:[]),this.recordHistory(n,o?[o]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let n=tJ(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});this.sendPromise=i.then(()=>void 0).catch(()=>void 0);let l=await i;return this.processStreamResponse(l,n)}getHistory(e=!1){return structuredClone(e?np(this.history):this.history)}processStreamResponse(e,t){var n,i;return na(this,arguments,function*(){var l,r,o,a;let s=[];try{for(var u,p=!0,d=ns(e);!(l=(u=yield no(d.next())).done);p=!0){if(a=u.value,p=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;return void 0!==n&&nu(n)}(a)){let e=null==(i=null==(n=a.candidates)?void 0:n[0])?void 0:i.content;void 0!==e&&s.push(e)}yield yield no(a)}}catch(e){r={error:e}}finally{try{!p&&!l&&(o=d.return)&&(yield no(o.call(d)))}finally{if(r)throw r.error}}this.recordHistory(t,s)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(e=>void 0!==e.role)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...np(n)):this.history.push(e),this.history.push(...i)}}class nh extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,nh.prototype)}}class nm extends tt{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nn(e6.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s,u=(r={},null!=(o=tl(e,["config"]))&&(a=tl(o,["pageSize"]),void 0!==r&&null!=a&&ti(r,["_query","pageSize"],a),s=tl(o,["pageToken"]),void 0!==r&&null!=s&&ti(r,["_query","pageToken"],s)),r);return i=tn("files",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["files"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["files"],e)}return t}(e),n=new tb;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a=(r={},null!=(o=tl(e,["file"]))&&ti(r,["file"],o),r);return i=tn("upload/v1beta/files",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),t),l=new tN;return Object.assign(l,i),l})}}async get(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a=(r={},null!=(o=tl(e,["name"]))&&ti(r,["_url","file"],t1(o)),r);return i=tn("files/{file}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a=(r={},null!=(o=tl(e,["name"]))&&ti(r,["_url","file"],t1(o)),r);return i=tn("files/{file}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),t),l=new tR;return Object.assign(l,i),l})}}}function nf(e){let t={},n=tl(e,["data"]);if(null!=n&&ti(t,["data"],n),void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}function ng(e){let t={},n=tl(e,["languageCode"]);null!=n&&ti(t,["languageCode"],n);let i=tl(e,["voiceConfig"]);if(null!=i&&ti(t,["voiceConfig"],i),void 0!==tl(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return t}function ny(e){let t={},n=tl(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a,s,u,p,d,c,h;return n={},null!=(i=tl(t=e,["mediaResolution"]))&&ti(n,["mediaResolution"],i),null!=(l=tl(t,["codeExecutionResult"]))&&ti(n,["codeExecutionResult"],l),null!=(r=tl(t,["executableCode"]))&&ti(n,["executableCode"],r),null!=(o=tl(t,["fileData"]))&&ti(n,["fileData"],function(e){let t={};if(void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=tl(e,["fileUri"]);null!=n&&ti(t,["fileUri"],n);let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(o)),null!=(a=tl(t,["functionCall"]))&&ti(n,["functionCall"],function(e){let t={},n=tl(e,["id"]);null!=n&&ti(t,["id"],n);let i=tl(e,["args"]);null!=i&&ti(t,["args"],i);let l=tl(e,["name"]);if(null!=l&&ti(t,["name"],l),void 0!==tl(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==tl(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(a)),null!=(s=tl(t,["functionResponse"]))&&ti(n,["functionResponse"],s),null!=(u=tl(t,["inlineData"]))&&ti(n,["inlineData"],function(e){let t={},n=tl(e,["data"]);if(null!=n&&ti(t,["data"],n),void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(u)),null!=(p=tl(t,["text"]))&&ti(n,["text"],p),null!=(d=tl(t,["thought"]))&&ti(n,["thought"],d),null!=(c=tl(t,["thoughtSignature"]))&&ti(n,["thoughtSignature"],c),null!=(h=tl(t,["videoMetadata"]))&&ti(n,["videoMetadata"],h),n})),ti(t,["parts"],e)}let i=tl(e,["role"]);return null!=i&&ti(t,["role"],i),t}function nE(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["_url","model"],tx(e,i));let l=tl(t,["contents"]);if(null!=l){let e=tK(l);Array.isArray(e)&&(e=e.map(e=>ny(e))),ti(n,["contents"],e)}let r=tl(t,["config"]);return null!=r&&ti(n,["generationConfig"],function(e,t,n){var i;let l,r,o,a={},s=tl(t,["systemInstruction"]);void 0!==n&&null!=s&&ti(n,["systemInstruction"],ny(tJ(s)));let u=tl(t,["temperature"]);null!=u&&ti(a,["temperature"],u);let p=tl(t,["topP"]);null!=p&&ti(a,["topP"],p);let d=tl(t,["topK"]);null!=d&&ti(a,["topK"],d);let c=tl(t,["candidateCount"]);null!=c&&ti(a,["candidateCount"],c);let h=tl(t,["maxOutputTokens"]);null!=h&&ti(a,["maxOutputTokens"],h);let m=tl(t,["stopSequences"]);null!=m&&ti(a,["stopSequences"],m);let f=tl(t,["responseLogprobs"]);null!=f&&ti(a,["responseLogprobs"],f);let g=tl(t,["logprobs"]);null!=g&&ti(a,["logprobs"],g);let y=tl(t,["presencePenalty"]);null!=y&&ti(a,["presencePenalty"],y);let E=tl(t,["frequencyPenalty"]);null!=E&&ti(a,["frequencyPenalty"],E);let _=tl(t,["seed"]);null!=_&&ti(a,["seed"],_);let T=tl(t,["responseMimeType"]);null!=T&&ti(a,["responseMimeType"],T);let v=tl(t,["responseSchema"]);null!=v&&ti(a,["responseSchema"],tW(v));let I=tl(t,["responseJsonSchema"]);if(null!=I&&ti(a,["responseJsonSchema"],I),void 0!==tl(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==tl(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let A=tl(t,["safetySettings"]);if(void 0!==n&&null!=A){let e=A;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["category"]);if(null!=n&&ti(t,["category"],n),void 0!==tl(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let i=tl(e,["threshold"]);return null!=i&&ti(t,["threshold"],i),t})(e))),ti(n,["safetySettings"],e)}let C=tl(t,["tools"]);if(void 0!==n&&null!=C){let e=tQ(C);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["functionDeclarations"],e)}if(void 0!==tl(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tl(e,["googleSearchRetrieval"]);null!=i&&ti(t,["googleSearchRetrieval"],i);let l=tl(e,["computerUse"]);null!=l&&ti(t,["computerUse"],l);let r=tl(e,["fileSearch"]);null!=r&&ti(t,["fileSearch"],r);let o=tl(e,["codeExecution"]);if(null!=o&&ti(t,["codeExecution"],o),void 0!==tl(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=tl(e,["googleMaps"]);null!=a&&ti(t,["googleMaps"],function(e){let t={};if(void 0!==tl(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=tl(e,["enableWidget"]);return null!=n&&ti(t,["enableWidget"],n),t}(a));let s=tl(e,["googleSearch"]);null!=s&&ti(t,["googleSearch"],function(e){let t={};if(void 0!==tl(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==tl(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=tl(e,["timeRangeFilter"]);return null!=n&&ti(t,["timeRangeFilter"],n),t}(s));let u=tl(e,["urlContext"]);return null!=u&&ti(t,["urlContext"],u),t})(tX(e)))),ti(n,["tools"],e)}let S=tl(t,["toolConfig"]);if(void 0!==n&&null!=S&&ti(n,["toolConfig"],(l={},null!=(r=tl(i=S,["functionCallingConfig"]))&&ti(l,["functionCallingConfig"],function(e){let t={},n=tl(e,["mode"]);null!=n&&ti(t,["mode"],n);let i=tl(e,["allowedFunctionNames"]);if(null!=i&&ti(t,["allowedFunctionNames"],i),void 0!==tl(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(r)),null!=(o=tl(i,["retrievalConfig"]))&&ti(l,["retrievalConfig"],o),l)),void 0!==tl(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let O=tl(t,["cachedContent"]);void 0!==n&&null!=O&&ti(n,["cachedContent"],tZ(e,O));let b=tl(t,["responseModalities"]);null!=b&&ti(a,["responseModalities"],b);let N=tl(t,["mediaResolution"]);null!=N&&ti(a,["mediaResolution"],N);let R=tl(t,["speechConfig"]);if(null!=R&&ti(a,["speechConfig"],t$(R)),void 0!==tl(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let P=tl(t,["thinkingConfig"]);null!=P&&ti(a,["thinkingConfig"],P);let M=tl(t,["imageConfig"]);return null!=M&&ti(a,["imageConfig"],function(e){let t={},n=tl(e,["aspectRatio"]);null!=n&&ti(t,["aspectRatio"],n);let i=tl(e,["imageSize"]);if(null!=i&&ti(t,["imageSize"],i),void 0!==tl(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==tl(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(M)),a}(e,r,n)),n}function n_(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["_url","model"],tx(e,i));let l=tl(t,["contents"]);if(null!=l){let e=tK(l);Array.isArray(e)&&(e=e.map(e=>e)),ti(n,["contents"],e)}let r=tl(t,["config"]);return null!=r&&ti(n,["generationConfig"],function(e,t,n){var i;let l,r,o,a,s,u={},p=tl(t,["systemInstruction"]);void 0!==n&&null!=p&&ti(n,["systemInstruction"],tJ(p));let d=tl(t,["temperature"]);null!=d&&ti(u,["temperature"],d);let c=tl(t,["topP"]);null!=c&&ti(u,["topP"],c);let h=tl(t,["topK"]);null!=h&&ti(u,["topK"],h);let m=tl(t,["candidateCount"]);null!=m&&ti(u,["candidateCount"],m);let f=tl(t,["maxOutputTokens"]);null!=f&&ti(u,["maxOutputTokens"],f);let g=tl(t,["stopSequences"]);null!=g&&ti(u,["stopSequences"],g);let y=tl(t,["responseLogprobs"]);null!=y&&ti(u,["responseLogprobs"],y);let E=tl(t,["logprobs"]);null!=E&&ti(u,["logprobs"],E);let _=tl(t,["presencePenalty"]);null!=_&&ti(u,["presencePenalty"],_);let T=tl(t,["frequencyPenalty"]);null!=T&&ti(u,["frequencyPenalty"],T);let v=tl(t,["seed"]);null!=v&&ti(u,["seed"],v);let I=tl(t,["responseMimeType"]);null!=I&&ti(u,["responseMimeType"],I);let A=tl(t,["responseSchema"]);null!=A&&ti(u,["responseSchema"],tW(A));let C=tl(t,["responseJsonSchema"]);null!=C&&ti(u,["responseJsonSchema"],C);let S=tl(t,["routingConfig"]);null!=S&&ti(u,["routingConfig"],S);let O=tl(t,["modelSelectionConfig"]);null!=O&&ti(u,["modelConfig"],O);let b=tl(t,["safetySettings"]);if(void 0!==n&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>e)),ti(n,["safetySettings"],e)}let N=tl(t,["tools"]);if(void 0!==n&&null!=N){let e=tQ(N);Array.isArray(e)&&(e=e.map(e=>nM(tX(e)))),ti(n,["tools"],e)}let R=tl(t,["toolConfig"]);void 0!==n&&null!=R&&ti(n,["toolConfig"],R);let P=tl(t,["labels"]);void 0!==n&&null!=P&&ti(n,["labels"],P);let M=tl(t,["cachedContent"]);void 0!==n&&null!=M&&ti(n,["cachedContent"],tZ(e,M));let D=tl(t,["responseModalities"]);null!=D&&ti(u,["responseModalities"],D);let w=tl(t,["mediaResolution"]);null!=w&&ti(u,["mediaResolution"],w);let x=tl(t,["speechConfig"]);null!=x&&ti(u,["speechConfig"],nP(t$(x)));let U=tl(t,["audioTimestamp"]);null!=U&&ti(u,["audioTimestamp"],U);let k=tl(t,["thinkingConfig"]);null!=k&&ti(u,["thinkingConfig"],k);let q=tl(t,["imageConfig"]);return null!=q&&ti(u,["imageConfig"],(l={},null!=(r=tl(i=q,["aspectRatio"]))&&ti(l,["aspectRatio"],r),null!=(o=tl(i,["imageSize"]))&&ti(l,["imageSize"],o),null!=(a=tl(i,["outputMimeType"]))&&ti(l,["imageOutputOptions","mimeType"],a),null!=(s=tl(i,["outputCompressionQuality"]))&&ti(l,["imageOutputOptions","compressionQuality"],s),l)),u}(e,r,n)),n}function nT(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["content"]);null!=n&&ti(t,["content"],n);let i=tl(e,["citationMetadata"]);null!=i&&ti(t,["citationMetadata"],function(e){let t={},n=tl(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["citations"],e)}return t}(i));let l=tl(e,["tokenCount"]);null!=l&&ti(t,["tokenCount"],l);let r=tl(e,["finishReason"]);null!=r&&ti(t,["finishReason"],r);let o=tl(e,["avgLogprobs"]);null!=o&&ti(t,["avgLogprobs"],o);let a=tl(e,["groundingMetadata"]);null!=a&&ti(t,["groundingMetadata"],a);let s=tl(e,["index"]);null!=s&&ti(t,["index"],s);let u=tl(e,["logprobsResult"]);null!=u&&ti(t,["logprobsResult"],u);let p=tl(e,["safetyRatings"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["safetyRatings"],e)}let d=tl(e,["urlContextMetadata"]);return null!=d&&ti(t,["urlContextMetadata"],d),t})(e))),ti(t,["candidates"],e)}let l=tl(e,["modelVersion"]);null!=l&&ti(t,["modelVersion"],l);let r=tl(e,["promptFeedback"]);null!=r&&ti(t,["promptFeedback"],r);let o=tl(e,["responseId"]);null!=o&&ti(t,["responseId"],o);let a=tl(e,["usageMetadata"]);return null!=a&&ti(t,["usageMetadata"],a),t}function nv(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["candidates"],e)}let l=tl(e,["createTime"]);null!=l&&ti(t,["createTime"],l);let r=tl(e,["modelVersion"]);null!=r&&ti(t,["modelVersion"],r);let o=tl(e,["promptFeedback"]);null!=o&&ti(t,["promptFeedback"],o);let a=tl(e,["responseId"]);null!=a&&ti(t,["responseId"],a);let s=tl(e,["usageMetadata"]);return null!=s&&ti(t,["usageMetadata"],s),t}function nI(e){let t={},n=tl(e,["_self"]);null!=n&&ti(t,["image"],nA(n));let i=tl(e,["raiFilteredReason"]);null!=i&&ti(t,["raiFilteredReason"],i);let l=tl(e,["_self"]);null!=l&&ti(t,["safetyAttributes"],nR(l));let r=tl(e,["prompt"]);return null!=r&&ti(t,["enhancedPrompt"],r),t}function nA(e){let t={},n=tl(e,["gcsUri"]);null!=n&&ti(t,["gcsUri"],n);let i=tl(e,["bytesBase64Encoded"]);null!=i&&ti(t,["imageBytes"],tr(i));let l=tl(e,["mimeType"]);return null!=l&&ti(t,["mimeType"],l),t}function nC(e){let t={};if(void 0!==tl(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let n=tl(e,["imageBytes"]);null!=n&&ti(t,["bytesBase64Encoded"],tr(n));let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}function nS(e){let t={},n=tl(e,["gcsUri"]);null!=n&&ti(t,["gcsUri"],n);let i=tl(e,["imageBytes"]);null!=i&&ti(t,["bytesBase64Encoded"],tr(i));let l=tl(e,["mimeType"]);return null!=l&&ti(t,["mimeType"],l),t}function nO(e){var t;let n,i,l,r,o={},a=tl(e,["name"]);null!=a&&ti(o,["name"],a);let s=tl(e,["displayName"]);null!=s&&ti(o,["displayName"],s);let u=tl(e,["description"]);null!=u&&ti(o,["description"],u);let p=tl(e,["version"]);null!=p&&ti(o,["version"],p);let d=tl(e,["_self"]);null!=d&&ti(o,["tunedModelInfo"],(n={},null!=(i=tl(t=d,["baseModel"]))&&ti(n,["baseModel"],i),null!=(l=tl(t,["createTime"]))&&ti(n,["createTime"],l),null!=(r=tl(t,["updateTime"]))&&ti(n,["updateTime"],r),n));let c=tl(e,["inputTokenLimit"]);null!=c&&ti(o,["inputTokenLimit"],c);let h=tl(e,["outputTokenLimit"]);null!=h&&ti(o,["outputTokenLimit"],h);let m=tl(e,["supportedGenerationMethods"]);null!=m&&ti(o,["supportedActions"],m);let f=tl(e,["temperature"]);null!=f&&ti(o,["temperature"],f);let g=tl(e,["maxTemperature"]);null!=g&&ti(o,["maxTemperature"],g);let y=tl(e,["topP"]);null!=y&&ti(o,["topP"],y);let E=tl(e,["topK"]);null!=E&&ti(o,["topK"],E);let _=tl(e,["thinking"]);return null!=_&&ti(o,["thinking"],_),o}function nb(e){var t;let n,i,l,r,o={},a=tl(e,["name"]);null!=a&&ti(o,["name"],a);let s=tl(e,["displayName"]);null!=s&&ti(o,["displayName"],s);let u=tl(e,["description"]);null!=u&&ti(o,["description"],u);let p=tl(e,["versionId"]);null!=p&&ti(o,["version"],p);let d=tl(e,["deployedModels"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>{let t,n,i;return t={},null!=(n=tl(e,["endpoint"]))&&ti(t,["name"],n),null!=(i=tl(e,["deployedModelId"]))&&ti(t,["deployedModelId"],i),t})),ti(o,["endpoints"],e)}let c=tl(e,["labels"]);null!=c&&ti(o,["labels"],c);let h=tl(e,["_self"]);null!=h&&ti(o,["tunedModelInfo"],(n={},null!=(i=tl(t=h,["labels","google-vertex-llm-tuning-base-model-id"]))&&ti(n,["baseModel"],i),null!=(l=tl(t,["createTime"]))&&ti(n,["createTime"],l),null!=(r=tl(t,["updateTime"]))&&ti(n,["updateTime"],r),n));let m=tl(e,["defaultCheckpointId"]);null!=m&&ti(o,["defaultCheckpointId"],m);let f=tl(e,["checkpoints"]);if(null!=f){let e=f;Array.isArray(e)&&(e=e.map(e=>e)),ti(o,["checkpoints"],e)}return o}function nN(e){let t={},n=tl(e,["safetyAttributes","categories"]);null!=n&&ti(t,["categories"],n);let i=tl(e,["safetyAttributes","scores"]);null!=i&&ti(t,["scores"],i);let l=tl(e,["contentType"]);return null!=l&&ti(t,["contentType"],l),t}function nR(e){let t={},n=tl(e,["safetyAttributes","categories"]);null!=n&&ti(t,["categories"],n);let i=tl(e,["safetyAttributes","scores"]);null!=i&&ti(t,["scores"],i);let l=tl(e,["contentType"]);return null!=l&&ti(t,["contentType"],l),t}function nP(e){let t={},n=tl(e,["languageCode"]);null!=n&&ti(t,["languageCode"],n);let i=tl(e,["voiceConfig"]);if(null!=i&&ti(t,["voiceConfig"],i),void 0!==tl(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return t}function nM(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==tl(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=tl(e,["description"]);null!=n&&ti(t,["description"],n);let i=tl(e,["name"]);null!=i&&ti(t,["name"],i);let l=tl(e,["parameters"]);null!=l&&ti(t,["parameters"],l);let r=tl(e,["parametersJsonSchema"]);null!=r&&ti(t,["parametersJsonSchema"],r);let o=tl(e,["response"]);null!=o&&ti(t,["response"],o);let a=tl(e,["responseJsonSchema"]);return null!=a&&ti(t,["responseJsonSchema"],a),t})(e))),ti(t,["functionDeclarations"],e)}let i=tl(e,["retrieval"]);null!=i&&ti(t,["retrieval"],i);let l=tl(e,["googleSearchRetrieval"]);null!=l&&ti(t,["googleSearchRetrieval"],l);let r=tl(e,["computerUse"]);if(null!=r&&ti(t,["computerUse"],r),void 0!==tl(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let o=tl(e,["codeExecution"]);null!=o&&ti(t,["codeExecution"],o);let a=tl(e,["enterpriseWebSearch"]);null!=a&&ti(t,["enterpriseWebSearch"],a);let s=tl(e,["googleMaps"]);null!=s&&ti(t,["googleMaps"],s);let u=tl(e,["googleSearch"]);null!=u&&ti(t,["googleSearch"],u);let p=tl(e,["urlContext"]);return null!=p&&ti(t,["urlContext"],p),t}function nD(e){let t={},n=tl(e,["uri"]);null!=n&&ti(t,["uri"],n);let i=tl(e,["videoBytes"]);null!=i&&ti(t,["encodedVideo"],tr(i));let l=tl(e,["mimeType"]);return null!=l&&ti(t,["encoding"],l),t}function nw(e){let t={},n=tl(e,["uri"]);null!=n&&ti(t,["gcsUri"],n);let i=tl(e,["videoBytes"]);null!=i&&ti(t,["bytesBase64Encoded"],tr(i));let l=tl(e,["mimeType"]);return null!=l&&ti(t,["mimeType"],l),t}let nx="x-goog-api-client",nU=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class nk{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=null!=(t=this.clientOptions.apiVersion)?t:"v1beta1",i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=null!=(n=this.clientOptions.apiVersion)?n:"v1beta",i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),""!==e&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))i.searchParams.append(t,String(n));let l={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else l.body=e.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,t,i.toString(),e.abortSignal),this.unaryApiCall(i,l,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,i]of Object.entries(t))"object"==typeof i?n[e]=Object.assign(Object.assign({},n[e]),i):void 0!==i&&(n[e]=i);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);i.searchParams.has("alt")&&"sse"===i.searchParams.get("alt")||i.searchParams.set("alt","sse");let l={};return l.body=e.body,l=await this.includeExtraHttpOptionsToRequestInit(l,t,i.toString(),e.abortSignal),this.streamApiCall(i,l,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,i){if(t&&t.timeout||i){let n=new AbortController,l=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}i&&i.addEventListener("abort",()=>{n.abort()}),e.signal=l}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}e.body=JSON.stringify(function e(t,n){let i=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let l=n[t],r=i[t];l&&"object"==typeof l&&!Array.isArray(l)&&r&&"object"==typeof r&&!Array.isArray(r)?i[t]=e(r,l):(r&&l&&typeof r!=typeof l&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof r}, New type: ${typeof l}. Overwriting.`),i[t]=l)}return i}(n,t))}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nq(e),new ta(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nq(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return na(this,arguments,function*(){let n=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),i=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="";for(;;){let{done:l,value:r}=yield no(n.read());if(l){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let o=i.decode(r,{stream:!0});try{let e=JSON.parse(o);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,i=t.code,l=`got status: ${n}. ${JSON.stringify(e)}`;if(i>=400&&i<600)throw new nh({message:l,status:i})}}catch(e){if("ApiError"===e.name)throw e}let a=(t+=o).match(nU);for(;a;){let n=a[1];try{let i=new Response(n,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield no(new ta(i)),a=(t=t.slice(a[0].length)).match(nU)}catch(e){throw Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.30.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[nx]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,i]of Object.entries(e.headers))n.append(t,i);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return"string"==typeof e&&(n=null!=(t=(n=e.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())?t:""),n}async uploadFile(e,t){var n;let i={};null!=t&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let l=this.clientOptions.uploader,r=await l.stat(e);i.sizeBytes=String(r.size);let o=null!=(n=null==t?void 0:t.mimeType)?n:r.type;if(void 0===o||""===o)throw Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=o;let a={file:i},s=this.getFileName(e),u=tn("upload/v1beta/files",a._url),p=await this.fetchUploadUrl(u,i.sizeBytes,i.mimeType,s,a,null==t?void 0:t.httpOptions);return l.upload(e,p,this)}async uploadFileToFileSearchStore(e,t,n){var i;let l=this.clientOptions.uploader,r=await l.stat(t),o=String(r.size),a=null!=(i=null==n?void 0:n.mimeType)?i:r.type;if(void 0===a||""===a)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let s=`upload/v1beta/${e}:uploadToFileSearchStore`,u=this.getFileName(t),p={};(null==n?void 0:n.customMetadata)&&(p.customMetadata=n.customMetadata),(null==n?void 0:n.chunkingConfig)&&(p.chunkingConfig=n.chunkingConfig);let d=await this.fetchUploadUrl(s,o,a,u,p,null==n?void 0:n.httpOptions);return l.uploadToFileSearchStore(t,d,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,n,i,l,r){var o;let a={};a=r||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},i?{"X-Goog-Upload-File-Name":i}:{})};let s=await this.request({path:e,body:JSON.stringify(l),httpMethod:"POST",httpOptions:a});if(!s||!(null==s?void 0:s.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let u=null==(o=null==s?void 0:s.headers)?void 0:o["x-goog-upload-url"];if(void 0===u)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function nq(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,i=JSON.stringify((null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new nh({message:i,status:n});throw Error(i)}}function nG(e){for(let n of e){var t;if(null!==(t=n)&&"object"==typeof t&&t instanceof nF||"object"==typeof n&&"inputSchema"in n)return!0}return!1}function nL(e){var t;let n=null!=(t=e[nx])?t:"";e[nx]=(n+" mcp_used/unknown").trimStart()}class nF{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new nF(e,t)}async initialize(){var e,t,n,i;if(this.mcpTools.length>0)return;let l={},r=[];for(let u of this.mcpClients)try{for(var o,a=!0,s=(t=void 0,ns(function(e,t=100){return na(this,arguments,function*(){let n,i=0;for(;i<t;){let t=yield no(e.listTools({cursor:n}));for(let e of t.tools)yield yield no(e),i++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(o=await s.next()).done);a=!0){i=o.value,a=!1,r.push(i);let e=i.name;if(l[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);l[e]=u}}catch(e){t={error:e}}finally{try{!a&&!e&&(n=s.return)&&await n.call(s)}finally{if(t)throw t.error}}this.mcpTools=r,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),function(e,t={}){let n=[],i=new Set;for(let l of e){let e=l.name;if(i.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i.add(e);let r=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(l,t);r.functionDeclarations&&n.push(...r.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e,i=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let l=await i.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:l.isError?{error:l}:l}})}return t}}async function nH(e,t,n){let i=new tD;Object.assign(i,n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data)),t(i)}class nj{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;let i;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let l=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),s=`${l}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`,u=()=>{},p=new Promise(e=>{u=e}),d=e.callbacks,c=this.apiClient,h={onopen:function(){u({})},onmessage:e=>{nH(c,d.onmessage,e)},onerror:null!=(t=null==d?void 0:d.onerror)?t:function(e){},onclose:null!=(n=null==d?void 0:d.onclose)?n:function(e){}},m=this.webSocketFactory.create(s,(i={},o.forEach((e,t)=>{i[t]=e}),i),h);m.connect(),await p;let f=tx(this.apiClient,e.model);return m.send(JSON.stringify({setup:{model:f}})),new nV(m,this.apiClient)}}class nV{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=tl(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){let t,n;e.musicGenerationConfig||(e.musicGenerationConfig={});let i=(t={},null!=(n=tl(e,["musicGenerationConfig"]))&&ti(t,["musicGenerationConfig"],n),t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(e3.PLAY)}pause(){this.sendPlaybackControl(e3.PAUSE)}stop(){this.sendPlaybackControl(e3.STOP)}resetContext(){this.sendPlaybackControl(e3.RESET_CONTEXT)}close(){this.conn.close()}}async function nB(e,t,n){let i=new tM,l=JSON.parse(n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data);if(e.isVertexAI()){let e,t,n,r,o,a,s,u;Object.assign(i,(e={},null!=(t=tl(l,["setupComplete"]))&&ti(e,["setupComplete"],t),null!=(n=tl(l,["serverContent"]))&&ti(e,["serverContent"],n),null!=(r=tl(l,["toolCall"]))&&ti(e,["toolCall"],r),null!=(o=tl(l,["toolCallCancellation"]))&&ti(e,["toolCallCancellation"],o),null!=(a=tl(l,["usageMetadata"]))&&ti(e,["usageMetadata"],function(e){let t={},n=tl(e,["promptTokenCount"]);null!=n&&ti(t,["promptTokenCount"],n);let i=tl(e,["cachedContentTokenCount"]);null!=i&&ti(t,["cachedContentTokenCount"],i);let l=tl(e,["candidatesTokenCount"]);null!=l&&ti(t,["responseTokenCount"],l);let r=tl(e,["toolUsePromptTokenCount"]);null!=r&&ti(t,["toolUsePromptTokenCount"],r);let o=tl(e,["thoughtsTokenCount"]);null!=o&&ti(t,["thoughtsTokenCount"],o);let a=tl(e,["totalTokenCount"]);null!=a&&ti(t,["totalTokenCount"],a);let s=tl(e,["promptTokensDetails"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["promptTokensDetails"],e)}let u=tl(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["cacheTokensDetails"],e)}let p=tl(e,["candidatesTokensDetails"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["responseTokensDetails"],e)}let d=tl(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["toolUsePromptTokensDetails"],e)}let c=tl(e,["trafficType"]);return null!=c&&ti(t,["trafficType"],c),t}(a)),null!=(s=tl(l,["goAway"]))&&ti(e,["goAway"],s),null!=(u=tl(l,["sessionResumptionUpdate"]))&&ti(e,["sessionResumptionUpdate"],u),e))}else Object.assign(i,l);t(i)}class nJ{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new nj(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,l,r,o,a,s;let u,p;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),h=this.apiClient.getHeaders();e.config&&e.config.tools&&nG(e.config.tools)&&nL(h);let m=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(h);if(this.apiClient.isVertexAI())u=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m,u);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==c&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),u=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.${t}?${n}=${e}`}let f=()=>{},g=new Promise(e=>{f=e}),y=e.callbacks,E=this.apiClient,_={onopen:function(){var e;null==(e=null==y?void 0:y.onopen)||e.call(y),f({})},onmessage:e=>{nB(E,y.onmessage,e)},onerror:null!=(t=null==y?void 0:y.onerror)?t:function(e){},onclose:null!=(n=null==y?void 0:y.onclose)?n:function(e){}},T=this.webSocketFactory.create(u,(p={},m.forEach((e,t)=>{p[t]=e}),p),_);T.connect(),await g;let v=tx(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&v.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();v=`projects/${e}/locations/${t}/`+v}let I={};this.apiClient.isVertexAI()&&(null==(i=e.config)?void 0:i.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[eC.AUDIO]}:e.config.responseModalities=[eC.AUDIO]),(null==(l=e.config)?void 0:l.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let A=null!=(o=null==(r=e.config)?void 0:r.tools)?o:[],C=[];for(let e of A)this.isCallableTool(e)?C.push(await e.tool()):C.push(e);C.length>0&&(e.config.tools=C);let S={model:v,config:e.config,callbacks:e.callbacks};if(this.apiClient.isVertexAI()){let e,t,n;a=this.apiClient,e={},null!=(t=tl(S,["model"]))&&ti(e,["setup","model"],tx(a,t)),null!=(n=tl(S,["config"]))&&ti(e,["config"],function(e,t){let n=tl(e,["generationConfig"]);void 0!==t&&null!=n&&ti(t,["setup","generationConfig"],function(e){let t={},n=tl(e,["modelSelectionConfig"]);null!=n&&ti(t,["modelConfig"],n);let i=tl(e,["responseJsonSchema"]);null!=i&&ti(t,["responseJsonSchema"],i);let l=tl(e,["audioTimestamp"]);null!=l&&ti(t,["audioTimestamp"],l);let r=tl(e,["candidateCount"]);null!=r&&ti(t,["candidateCount"],r);let o=tl(e,["enableAffectiveDialog"]);null!=o&&ti(t,["enableAffectiveDialog"],o);let a=tl(e,["frequencyPenalty"]);null!=a&&ti(t,["frequencyPenalty"],a);let s=tl(e,["logprobs"]);null!=s&&ti(t,["logprobs"],s);let u=tl(e,["maxOutputTokens"]);null!=u&&ti(t,["maxOutputTokens"],u);let p=tl(e,["mediaResolution"]);null!=p&&ti(t,["mediaResolution"],p);let d=tl(e,["presencePenalty"]);null!=d&&ti(t,["presencePenalty"],d);let c=tl(e,["responseLogprobs"]);null!=c&&ti(t,["responseLogprobs"],c);let h=tl(e,["responseMimeType"]);null!=h&&ti(t,["responseMimeType"],h);let m=tl(e,["responseModalities"]);null!=m&&ti(t,["responseModalities"],m);let f=tl(e,["responseSchema"]);null!=f&&ti(t,["responseSchema"],f);let g=tl(e,["routingConfig"]);null!=g&&ti(t,["routingConfig"],g);let y=tl(e,["seed"]);null!=y&&ti(t,["seed"],y);let E=tl(e,["speechConfig"]);null!=E&&ti(t,["speechConfig"],ng(E));let _=tl(e,["stopSequences"]);null!=_&&ti(t,["stopSequences"],_);let T=tl(e,["temperature"]);null!=T&&ti(t,["temperature"],T);let v=tl(e,["thinkingConfig"]);null!=v&&ti(t,["thinkingConfig"],v);let I=tl(e,["topK"]);null!=I&&ti(t,["topK"],I);let A=tl(e,["topP"]);if(null!=A&&ti(t,["topP"],A),void 0!==tl(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let i=tl(e,["responseModalities"]);void 0!==t&&null!=i&&ti(t,["setup","generationConfig","responseModalities"],i);let l=tl(e,["temperature"]);void 0!==t&&null!=l&&ti(t,["setup","generationConfig","temperature"],l);let r=tl(e,["topP"]);void 0!==t&&null!=r&&ti(t,["setup","generationConfig","topP"],r);let o=tl(e,["topK"]);void 0!==t&&null!=o&&ti(t,["setup","generationConfig","topK"],o);let a=tl(e,["maxOutputTokens"]);void 0!==t&&null!=a&&ti(t,["setup","generationConfig","maxOutputTokens"],a);let s=tl(e,["mediaResolution"]);void 0!==t&&null!=s&&ti(t,["setup","generationConfig","mediaResolution"],s);let u=tl(e,["seed"]);void 0!==t&&null!=u&&ti(t,["setup","generationConfig","seed"],u);let p=tl(e,["speechConfig"]);void 0!==t&&null!=p&&ti(t,["setup","generationConfig","speechConfig"],ng(tz(p)));let d=tl(e,["thinkingConfig"]);void 0!==t&&null!=d&&ti(t,["setup","generationConfig","thinkingConfig"],d);let c=tl(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&ti(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=tl(e,["systemInstruction"]);void 0!==t&&null!=h&&ti(t,["setup","systemInstruction"],tJ(h));let m=tl(e,["tools"]);if(void 0!==t&&null!=m){let e=tQ(m);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==tl(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=tl(e,["description"]);null!=n&&ti(t,["description"],n);let i=tl(e,["name"]);null!=i&&ti(t,["name"],i);let l=tl(e,["parameters"]);null!=l&&ti(t,["parameters"],l);let r=tl(e,["parametersJsonSchema"]);null!=r&&ti(t,["parametersJsonSchema"],r);let o=tl(e,["response"]);null!=o&&ti(t,["response"],o);let a=tl(e,["responseJsonSchema"]);return null!=a&&ti(t,["responseJsonSchema"],a),t})(e))),ti(t,["functionDeclarations"],e)}let i=tl(e,["retrieval"]);null!=i&&ti(t,["retrieval"],i);let l=tl(e,["googleSearchRetrieval"]);null!=l&&ti(t,["googleSearchRetrieval"],l);let r=tl(e,["computerUse"]);if(null!=r&&ti(t,["computerUse"],r),void 0!==tl(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let o=tl(e,["codeExecution"]);null!=o&&ti(t,["codeExecution"],o);let a=tl(e,["enterpriseWebSearch"]);null!=a&&ti(t,["enterpriseWebSearch"],a);let s=tl(e,["googleMaps"]);null!=s&&ti(t,["googleMaps"],s);let u=tl(e,["googleSearch"]);null!=u&&ti(t,["googleSearch"],u);let p=tl(e,["urlContext"]);return null!=p&&ti(t,["urlContext"],p),t})(tX(e)))),ti(t,["setup","tools"],e)}let f=tl(e,["sessionResumption"]);void 0!==t&&null!=f&&ti(t,["setup","sessionResumption"],f);let g=tl(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&ti(t,["setup","inputAudioTranscription"],g);let y=tl(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&ti(t,["setup","outputAudioTranscription"],y);let E=tl(e,["realtimeInputConfig"]);void 0!==t&&null!=E&&ti(t,["setup","realtimeInputConfig"],E);let _=tl(e,["contextWindowCompression"]);void 0!==t&&null!=_&&ti(t,["setup","contextWindowCompression"],_);let T=tl(e,["proactivity"]);return void 0!==t&&null!=T&&ti(t,["setup","proactivity"],T),{}}(n,e)),I=e}else{let e,t,n;s=this.apiClient,e={},null!=(t=tl(S,["model"]))&&ti(e,["setup","model"],tx(s,t)),null!=(n=tl(S,["config"]))&&ti(e,["config"],function(e,t){let n=tl(e,["generationConfig"]);void 0!==t&&null!=n&&ti(t,["setup","generationConfig"],n);let i=tl(e,["responseModalities"]);void 0!==t&&null!=i&&ti(t,["setup","generationConfig","responseModalities"],i);let l=tl(e,["temperature"]);void 0!==t&&null!=l&&ti(t,["setup","generationConfig","temperature"],l);let r=tl(e,["topP"]);void 0!==t&&null!=r&&ti(t,["setup","generationConfig","topP"],r);let o=tl(e,["topK"]);void 0!==t&&null!=o&&ti(t,["setup","generationConfig","topK"],o);let a=tl(e,["maxOutputTokens"]);void 0!==t&&null!=a&&ti(t,["setup","generationConfig","maxOutputTokens"],a);let s=tl(e,["mediaResolution"]);void 0!==t&&null!=s&&ti(t,["setup","generationConfig","mediaResolution"],s);let u=tl(e,["seed"]);void 0!==t&&null!=u&&ti(t,["setup","generationConfig","seed"],u);let p=tl(e,["speechConfig"]);void 0!==t&&null!=p&&ti(t,["setup","generationConfig","speechConfig"],tz(p));let d=tl(e,["thinkingConfig"]);void 0!==t&&null!=d&&ti(t,["setup","generationConfig","thinkingConfig"],d);let c=tl(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&ti(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=tl(e,["systemInstruction"]);void 0!==t&&null!=h&&ti(t,["setup","systemInstruction"],function(e){let t={},n=tl(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a,s,u,p,d,c,h;return n={},null!=(i=tl(t=e,["mediaResolution"]))&&ti(n,["mediaResolution"],i),null!=(l=tl(t,["codeExecutionResult"]))&&ti(n,["codeExecutionResult"],l),null!=(r=tl(t,["executableCode"]))&&ti(n,["executableCode"],r),null!=(o=tl(t,["fileData"]))&&ti(n,["fileData"],function(e){let t={};if(void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=tl(e,["fileUri"]);null!=n&&ti(t,["fileUri"],n);let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(o)),null!=(a=tl(t,["functionCall"]))&&ti(n,["functionCall"],function(e){let t={},n=tl(e,["id"]);null!=n&&ti(t,["id"],n);let i=tl(e,["args"]);null!=i&&ti(t,["args"],i);let l=tl(e,["name"]);if(null!=l&&ti(t,["name"],l),void 0!==tl(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==tl(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(a)),null!=(s=tl(t,["functionResponse"]))&&ti(n,["functionResponse"],s),null!=(u=tl(t,["inlineData"]))&&ti(n,["inlineData"],nf(u)),null!=(p=tl(t,["text"]))&&ti(n,["text"],p),null!=(d=tl(t,["thought"]))&&ti(n,["thought"],d),null!=(c=tl(t,["thoughtSignature"]))&&ti(n,["thoughtSignature"],c),null!=(h=tl(t,["videoMetadata"]))&&ti(n,["videoMetadata"],h),n})),ti(t,["parts"],e)}let i=tl(e,["role"]);return null!=i&&ti(t,["role"],i),t}(tJ(h)));let m=tl(e,["tools"]);if(void 0!==t&&null!=m){let e=tQ(m);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["functionDeclarations"],e)}if(void 0!==tl(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tl(e,["googleSearchRetrieval"]);null!=i&&ti(t,["googleSearchRetrieval"],i);let l=tl(e,["computerUse"]);null!=l&&ti(t,["computerUse"],l);let r=tl(e,["fileSearch"]);null!=r&&ti(t,["fileSearch"],r);let o=tl(e,["codeExecution"]);if(null!=o&&ti(t,["codeExecution"],o),void 0!==tl(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=tl(e,["googleMaps"]);null!=a&&ti(t,["googleMaps"],function(e){let t={};if(void 0!==tl(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=tl(e,["enableWidget"]);return null!=n&&ti(t,["enableWidget"],n),t}(a));let s=tl(e,["googleSearch"]);null!=s&&ti(t,["googleSearch"],function(e){let t={};if(void 0!==tl(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==tl(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=tl(e,["timeRangeFilter"]);return null!=n&&ti(t,["timeRangeFilter"],n),t}(s));let u=tl(e,["urlContext"]);return null!=u&&ti(t,["urlContext"],u),t})(tX(e)))),ti(t,["setup","tools"],e)}let f=tl(e,["sessionResumption"]);void 0!==t&&null!=f&&ti(t,["setup","sessionResumption"],function(e){let t={},n=tl(e,["handle"]);if(null!=n&&ti(t,["handle"],n),void 0!==tl(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(f));let g=tl(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&ti(t,["setup","inputAudioTranscription"],g);let y=tl(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&ti(t,["setup","outputAudioTranscription"],y);let E=tl(e,["realtimeInputConfig"]);void 0!==t&&null!=E&&ti(t,["setup","realtimeInputConfig"],E);let _=tl(e,["contextWindowCompression"]);void 0!==t&&null!=_&&ti(t,["setup","contextWindowCompression"],_);let T=tl(e,["proactivity"]);return void 0!==t&&null!=T&&ti(t,["setup","proactivity"],T),{}}(n,e)),I=e}return delete I.config,T.send(JSON.stringify(I)),new nK(T,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let nY={turnComplete:!0};class nK{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=tK(t.turns),e.isVertexAI()||(n=n.map(e=>ny(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},nY),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=tl(e,["media"]);if(null!=n){let e=tk(n);Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["mediaChunks"],e)}let i=tl(e,["audio"]);null!=i&&ti(t,["audio"],tL(i));let l=tl(e,["audioStreamEnd"]);null!=l&&ti(t,["audioStreamEnd"],l);let r=tl(e,["video"]);null!=r&&ti(t,["video"],tG(r));let o=tl(e,["text"]);null!=o&&ti(t,["text"],o);let a=tl(e,["activityStart"]);null!=a&&ti(t,["activityStart"],a);let s=tl(e,["activityEnd"]);return null!=s&&ti(t,["activityEnd"],s),t}(e)}:{realtimeInput:function(e){let t={},n=tl(e,["media"]);if(null!=n){let e=tk(n);Array.isArray(e)&&(e=e.map(e=>nf(e))),ti(t,["mediaChunks"],e)}let i=tl(e,["audio"]);null!=i&&ti(t,["audio"],nf(tL(i)));let l=tl(e,["audioStreamEnd"]);null!=l&&ti(t,["audioStreamEnd"],l);let r=tl(e,["video"]);null!=r&&ti(t,["video"],nf(tG(r)));let o=tl(e,["text"]);null!=o&&ti(t,["text"],o);let a=tl(e,["activityStart"]);null!=a&&ti(t,["activityStart"],a);let s=tl(e,["activityEnd"]);return null!=s&&ti(t,["activityEnd"],s),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function nW(e){var t,n,i;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let l=!1;for(let t of null!=(n=null==e?void 0:e.tools)?n:[])if(n$(t)){l=!0;break}if(!l)return!0;let r=null==(i=null==e?void 0:e.automaticFunctionCalling)?void 0:i.maximumRemoteCalls;return(!(!r||!(r<0)&&Number.isInteger(r))||0==r)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0)}function n$(e){return"callTool"in e&&"function"==typeof e.callTool}function nz(e){var t;let n=[];return(null==(t=null==e?void 0:e.config)?void 0:t.tools)&&e.config.tools.forEach((e,t)=>{n$(e)||e.functionDeclarations&&e.functionDeclarations.length>0&&n.push(t)}),n}function nX(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class nQ extends tt{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,i,l,r,o,a,s;let u,p,d=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!(null!=(s=null==(a=null==(o=e.config)?void 0:o.tools)?void 0:a.some(e=>n$(e)))&&s)||nW(e.config))return await this.generateContentInternal(d);let c=nz(e);if(c.length>0){let e=c.map(e=>`tools[${e}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let h=tK(d.contents),m=null!=(i=null==(n=null==(t=d.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,f=0;for(;f<m&&(u=await this.generateContentInternal(d)).functionCalls&&0!==u.functionCalls.length;){let t=u.candidates[0].content,n=[];for(let t of null!=(r=null==(l=e.config)?void 0:l.tools)?r:[])if(n$(t)){let e=await t.callTool(u.functionCalls);n.push(...e)}f++,p={role:"user",parts:n},d.contents=tK(d.contents),d.contents.push(t),d.contents.push(p),nX(d.config)&&(h.push(t),h.push(p))}return nX(d.config)&&(u.automaticFunctionCallingHistory=h),u},this.generateContentStream=async e=>{var t,n,i,l,r;if(this.maybeMoveToResponseJsonSchem(e),nW(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let o=nz(e);if(o.length>0){let e=o.map(e=>`tools[${e}]`).join(", ");throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let a=null==(i=null==(n=null==(t=null==e?void 0:e.config)?void 0:t.toolConfig)?void 0:n.functionCallingConfig)?void 0:i.streamFunctionCallArguments,s=null==(r=null==(l=null==e?void 0:e.config)?void 0:l.automaticFunctionCalling)?void 0:r.disable;if(a&&!s)throw Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n,i=[];if(null==e?void 0:e.generatedImages)for(let l of e.generatedImages)l&&(null==l?void 0:l.safetyAttributes)&&(null==(t=null==l?void 0:l.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?n=null==l?void 0:l.safetyAttributes:i.push(l);return n?{generatedImages:i,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:i,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase)if(null==(t=n.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else n.config.filter="labels.tune-type:*";return new nn(e6.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,i,l,r,o;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(t=e.video)?void 0:t.uri)&&(null==(n=e.video)?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null==(l=null==(i=e.source)?void 0:i.video)?void 0:l.uri)&&(null==(o=null==(r=e.source)?void 0:r.video)?void 0:o.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,i;let l=null==(t=e.config)?void 0:t.tools;if(!l)return e;let r=await Promise.all(l.map(async e=>n$(e)?await e.tool():e)),o={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:r})};if(o.config.tools=r,e.config&&e.config.tools&&nG(e.config.tools)){let t=Object.assign({},null!=(i=null==(n=e.config.httpOptions)?void 0:n.headers)?i:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),nL(t),o.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return o}async initAfcToolsMap(e){var t,n,i;let l=new Map;for(let r of null!=(n=null==(t=e.config)?void 0:t.tools)?n:[])if(n$(r))for(let e of null!=(i=(await r.tool()).functionDeclarations)?i:[]){if(!e.name)throw Error("Function declaration name is required.");if(l.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);l.set(e.name,r)}return l}async processAfcStream(e){var t,n,i;let l=null!=(i=null==(n=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,r=!1,o=0;return function(e,t,n){var i,a;return na(this,arguments,function*(){for(var s,u,p,d;o<l;){r&&(o++,r=!1);let f=yield no(e.processParamsMaybeAddMcpUsage(n)),g=yield no(e.generateContentStreamInternal(f)),y=[],E=[];try{for(var c,h=!0,m=(u=void 0,ns(g));!(s=(c=yield no(m.next())).done);h=!0)if(d=c.value,h=!1,yield yield no(d),d.candidates&&(null==(i=d.candidates[0])?void 0:i.content)){for(let e of(E.push(d.candidates[0].content),null!=(a=d.candidates[0].content.parts)?a:[]))if(o<l&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield no(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!h&&!s&&(p=m.return)&&(yield no(p.call(m)))}finally{if(u)throw u.error}}if(y.length>0){r=!0;let e=new ts;e.candidates=[{content:{role:"user",parts:y}}],yield yield no(e);let t=[];t.push(...E),t.push({role:"user",parts:y});let i=tK(n.contents).concat(t);n.contents=i}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i=n_(this.apiClient,e);return r=tn("{model}:generateContent",i._url),o=i._query,delete i._url,delete i._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=nv(e),n=new ts;return Object.assign(n,t),n})}{let t=nE(this.apiClient,e);return r=tn("{model}:generateContent",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=nT(e),n=new ts;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i=n_(this.apiClient,e);return r=tn("{model}:streamGenerateContent?alt=sse",i._url),o=i._query,delete i._url,delete i._query,this.apiClient.requestStream({path:r,queryParams:o,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(function(e){return na(this,arguments,function*(){var t,n,i,l;try{for(var r,o=!0,a=ns(e);!(t=(r=yield no(a.next())).done);o=!0){l=r.value,o=!1;let e=nv((yield no(l.json())));e.sdkHttpResponse={headers:l.headers};let t=new ts;Object.assign(t,e),yield yield no(t)}}catch(e){n={error:e}}finally{try{!o&&!t&&(i=a.return)&&(yield no(i.call(a)))}finally{if(n)throw n.error}}})})}{let t=nE(this.apiClient,e);return r=tn("{model}:streamGenerateContent?alt=sse",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:r,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(function(e){return na(this,arguments,function*(){var t,n,i,l;try{for(var r,o=!0,a=ns(e);!(t=(r=yield no(a.next())).done);o=!0){l=r.value,o=!1;let e=nT((yield no(l.json())));e.sdkHttpResponse={headers:l.headers};let t=new ts;Object.assign(t,e),yield yield no(t)}}catch(e){n={error:e}}finally{try{!o&&!t&&(i=a.return)&&(yield no(i.call(a)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n,i,l,r,o,a={},s=tl(t,["model"]);null!=s&&ti(a,["_url","model"],tx(e,s));let u=tl(t,["contents"]);if(null!=u){let t=tY(e,u);Array.isArray(t)&&(t=t.map(e=>e)),ti(a,["instances[]","content"],t)}let p=tl(t,["config"]);return null!=p&&(n=tl(p,["taskType"]),void 0!==a&&null!=n&&ti(a,["instances[]","task_type"],n),i=tl(p,["title"]),void 0!==a&&null!=i&&ti(a,["instances[]","title"],i),l=tl(p,["outputDimensionality"]),void 0!==a&&null!=l&&ti(a,["parameters","outputDimensionality"],l),r=tl(p,["mimeType"]),void 0!==a&&null!=r&&ti(a,["instances[]","mimeType"],r),o=tl(p,["autoTruncate"]),void 0!==a&&null!=o&&ti(a,["parameters","autoTruncate"],o)),a}(this.apiClient,e);return r=tn("{model}:predict",i._url),o=i._query,delete i._url,delete i._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["predictions[]","embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a;return n={},null!=(i=tl(e,["values"]))&&ti(n,["values"],i),null!=(l=tl(e,["statistics"]))&&ti(n,["statistics"],(r={},null!=(o=tl(t=l,["truncated"]))&&ti(r,["truncated"],o),null!=(a=tl(t,["token_count"]))&&ti(r,["tokenCount"],a),r)),n})),ti(t,["embeddings"],e)}let l=tl(e,["metadata"]);return null!=l&&ti(t,["metadata"],l),t}(e),n=new tu;return Object.assign(n,t),n})}{let t=function(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["_url","model"],tx(e,i));let l=tl(t,["contents"]);if(null!=l){let t=tY(e,l);Array.isArray(t)&&(t=t.map(e=>e)),ti(n,["requests[]","content"],t)}let r=tl(t,["config"]);null!=r&&function(e,t){let n=tl(e,["taskType"]);void 0!==t&&null!=n&&ti(t,["requests[]","taskType"],n);let i=tl(e,["title"]);void 0!==t&&null!=i&&ti(t,["requests[]","title"],i);let l=tl(e,["outputDimensionality"]);if(void 0!==t&&null!=l&&ti(t,["requests[]","outputDimensionality"],l),void 0!==tl(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==tl(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(r,n);let o=tl(t,["model"]);return void 0!==o&&ti(n,["requests[]","model"],tx(e,o)),n}(this.apiClient,e);return r=tn("{model}:batchEmbedContents",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["embeddings"],e)}let l=tl(e,["metadata"]);return null!=l&&ti(t,["metadata"],l),t}(e),n=new tu;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o,u,p,d,c,h,m,f,g,y,E,_,T,v,I,A,C,S,O,b=(r=this.apiClient,i={},null!=(l=tl(e,["model"]))&&ti(i,["_url","model"],tx(r,l)),null!=(o=tl(e,["prompt"]))&&ti(i,["instances[0]","prompt"],o),null!=(u=tl(e,["config"]))&&(p=tl(u,["outputGcsUri"]),void 0!==i&&null!=p&&ti(i,["parameters","storageUri"],p),d=tl(u,["negativePrompt"]),void 0!==i&&null!=d&&ti(i,["parameters","negativePrompt"],d),c=tl(u,["numberOfImages"]),void 0!==i&&null!=c&&ti(i,["parameters","sampleCount"],c),h=tl(u,["aspectRatio"]),void 0!==i&&null!=h&&ti(i,["parameters","aspectRatio"],h),m=tl(u,["guidanceScale"]),void 0!==i&&null!=m&&ti(i,["parameters","guidanceScale"],m),f=tl(u,["seed"]),void 0!==i&&null!=f&&ti(i,["parameters","seed"],f),g=tl(u,["safetyFilterLevel"]),void 0!==i&&null!=g&&ti(i,["parameters","safetySetting"],g),y=tl(u,["personGeneration"]),void 0!==i&&null!=y&&ti(i,["parameters","personGeneration"],y),E=tl(u,["includeSafetyAttributes"]),void 0!==i&&null!=E&&ti(i,["parameters","includeSafetyAttributes"],E),_=tl(u,["includeRaiReason"]),void 0!==i&&null!=_&&ti(i,["parameters","includeRaiReason"],_),T=tl(u,["language"]),void 0!==i&&null!=T&&ti(i,["parameters","language"],T),v=tl(u,["outputMimeType"]),void 0!==i&&null!=v&&ti(i,["parameters","outputOptions","mimeType"],v),I=tl(u,["outputCompressionQuality"]),void 0!==i&&null!=I&&ti(i,["parameters","outputOptions","compressionQuality"],I),A=tl(u,["addWatermark"]),void 0!==i&&null!=A&&ti(i,["parameters","addWatermark"],A),C=tl(u,["labels"]),void 0!==i&&null!=C&&ti(i,["labels"],C),S=tl(u,["imageSize"]),void 0!==i&&null!=S&&ti(i,["parameters","sampleImageSize"],S),O=tl(u,["enhancePrompt"]),void 0!==i&&null!=O&&ti(i,["parameters","enhancePrompt"],O)),i);return a=tn("{model}:predict",b._url),s=b._query,delete b._url,delete b._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nI(e))),ti(t,["generatedImages"],e)}let l=tl(e,["positivePromptSafetyAttributes"]);return null!=l&&ti(t,["positivePromptSafetyAttributes"],nR(l)),t}(e),n=new tp;return Object.assign(n,t),n})}{let t,n,r,u,p=(o=this.apiClient,t={},null!=(n=tl(e,["model"]))&&ti(t,["_url","model"],tx(o,n)),null!=(r=tl(e,["prompt"]))&&ti(t,["instances[0]","prompt"],r),null!=(u=tl(e,["config"]))&&function(e,t){if(void 0!==tl(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==tl(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let n=tl(e,["numberOfImages"]);void 0!==t&&null!=n&&ti(t,["parameters","sampleCount"],n);let i=tl(e,["aspectRatio"]);void 0!==t&&null!=i&&ti(t,["parameters","aspectRatio"],i);let l=tl(e,["guidanceScale"]);if(void 0!==t&&null!=l&&ti(t,["parameters","guidanceScale"],l),void 0!==tl(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let r=tl(e,["safetyFilterLevel"]);void 0!==t&&null!=r&&ti(t,["parameters","safetySetting"],r);let o=tl(e,["personGeneration"]);void 0!==t&&null!=o&&ti(t,["parameters","personGeneration"],o);let a=tl(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&ti(t,["parameters","includeSafetyAttributes"],a);let s=tl(e,["includeRaiReason"]);void 0!==t&&null!=s&&ti(t,["parameters","includeRaiReason"],s);let u=tl(e,["language"]);void 0!==t&&null!=u&&ti(t,["parameters","language"],u);let p=tl(e,["outputMimeType"]);void 0!==t&&null!=p&&ti(t,["parameters","outputOptions","mimeType"],p);let d=tl(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&ti(t,["parameters","outputOptions","compressionQuality"],d),void 0!==tl(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==tl(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let c=tl(e,["imageSize"]);if(void 0!==t&&null!=c&&ti(t,["parameters","sampleImageSize"],c),void 0!==tl(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(u,t),t);return a=tn("{model}:predict",p._url),s=p._query,delete p._url,delete p._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t,n;let i,l,r,o,a,s,u;return i={},null!=(l=tl(t=e,["_self"]))&&ti(i,["image"],(r={},null!=(o=tl(n=l,["bytesBase64Encoded"]))&&ti(r,["imageBytes"],tr(o)),null!=(a=tl(n,["mimeType"]))&&ti(r,["mimeType"],a),r)),null!=(s=tl(t,["raiFilteredReason"]))&&ti(i,["raiFilteredReason"],s),null!=(u=tl(t,["_self"]))&&ti(i,["safetyAttributes"],nN(u)),i})),ti(t,["generatedImages"],e)}let l=tl(e,["positivePromptSafetyAttributes"]);return null!=l&&ti(t,["positivePromptSafetyAttributes"],nN(l)),t}(e),n=new tp;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n,i,l,r,o,a,s,u,p,d,c,h,m,f,g,y,E,_={},T=tl(t,["model"]);null!=T&&ti(_,["_url","model"],tx(e,T));let v=tl(t,["prompt"]);null!=v&&ti(_,["instances[0]","prompt"],v);let I=tl(t,["referenceImages"]);if(null!=I){let e=I;Array.isArray(e)&&(e=e.map(e=>(function(e){let t,n,i,l,r,o,a,s={},u=tl(e,["referenceImage"]);null!=u&&ti(s,["referenceImage"],nS(u));let p=tl(e,["referenceId"]);null!=p&&ti(s,["referenceId"],p);let d=tl(e,["referenceType"]);null!=d&&ti(s,["referenceType"],d);let c=tl(e,["maskImageConfig"]);null!=c&&ti(s,["maskImageConfig"],(t={},null!=(n=tl(c,["maskMode"]))&&ti(t,["maskMode"],n),null!=(i=tl(c,["segmentationClasses"]))&&ti(t,["maskClasses"],i),null!=(l=tl(c,["maskDilation"]))&&ti(t,["dilation"],l),t));let h=tl(e,["controlImageConfig"]);null!=h&&ti(s,["controlImageConfig"],(r={},null!=(o=tl(h,["controlType"]))&&ti(r,["controlType"],o),null!=(a=tl(h,["enableControlImageComputation"]))&&ti(r,["computeControl"],a),r));let m=tl(e,["styleImageConfig"]);null!=m&&ti(s,["styleImageConfig"],m);let f=tl(e,["subjectImageConfig"]);return null!=f&&ti(s,["subjectImageConfig"],f),s})(e))),ti(_,["instances[0]","referenceImages"],e)}let A=tl(t,["config"]);return null!=A&&(n=tl(A,["outputGcsUri"]),void 0!==_&&null!=n&&ti(_,["parameters","storageUri"],n),i=tl(A,["negativePrompt"]),void 0!==_&&null!=i&&ti(_,["parameters","negativePrompt"],i),l=tl(A,["numberOfImages"]),void 0!==_&&null!=l&&ti(_,["parameters","sampleCount"],l),r=tl(A,["aspectRatio"]),void 0!==_&&null!=r&&ti(_,["parameters","aspectRatio"],r),o=tl(A,["guidanceScale"]),void 0!==_&&null!=o&&ti(_,["parameters","guidanceScale"],o),a=tl(A,["seed"]),void 0!==_&&null!=a&&ti(_,["parameters","seed"],a),s=tl(A,["safetyFilterLevel"]),void 0!==_&&null!=s&&ti(_,["parameters","safetySetting"],s),u=tl(A,["personGeneration"]),void 0!==_&&null!=u&&ti(_,["parameters","personGeneration"],u),p=tl(A,["includeSafetyAttributes"]),void 0!==_&&null!=p&&ti(_,["parameters","includeSafetyAttributes"],p),d=tl(A,["includeRaiReason"]),void 0!==_&&null!=d&&ti(_,["parameters","includeRaiReason"],d),c=tl(A,["language"]),void 0!==_&&null!=c&&ti(_,["parameters","language"],c),h=tl(A,["outputMimeType"]),void 0!==_&&null!=h&&ti(_,["parameters","outputOptions","mimeType"],h),m=tl(A,["outputCompressionQuality"]),void 0!==_&&null!=m&&ti(_,["parameters","outputOptions","compressionQuality"],m),f=tl(A,["addWatermark"]),void 0!==_&&null!=f&&ti(_,["parameters","addWatermark"],f),g=tl(A,["labels"]),void 0!==_&&null!=g&&ti(_,["labels"],g),y=tl(A,["editMode"]),void 0!==_&&null!=y&&ti(_,["parameters","editMode"],y),E=tl(A,["baseSteps"]),void 0!==_&&null!=E&&ti(_,["parameters","editConfig","baseSteps"],E)),_}(this.apiClient,e);return i=tn("{model}:predict",r._url),l=r._query,delete r._url,delete r._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nI(e))),ti(t,["generatedImages"],e)}return t}(e),n=new td;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n,i;let l="",r={};if(this.apiClient.isVertexAI()){let o,a,s,u,p,d,c,h,m,f,g,y,E,_,T,v,I=(i=this.apiClient,o={},null!=(a=tl(e,["model"]))&&ti(o,["_url","model"],tx(i,a)),null!=(s=tl(e,["image"]))&&ti(o,["instances[0]","image"],nS(s)),null!=(u=tl(e,["upscaleFactor"]))&&ti(o,["parameters","upscaleConfig","upscaleFactor"],u),null!=(p=tl(e,["config"]))&&(d=tl(p,["outputGcsUri"]),void 0!==o&&null!=d&&ti(o,["parameters","storageUri"],d),c=tl(p,["safetyFilterLevel"]),void 0!==o&&null!=c&&ti(o,["parameters","safetySetting"],c),h=tl(p,["personGeneration"]),void 0!==o&&null!=h&&ti(o,["parameters","personGeneration"],h),m=tl(p,["includeRaiReason"]),void 0!==o&&null!=m&&ti(o,["parameters","includeRaiReason"],m),f=tl(p,["outputMimeType"]),void 0!==o&&null!=f&&ti(o,["parameters","outputOptions","mimeType"],f),g=tl(p,["outputCompressionQuality"]),void 0!==o&&null!=g&&ti(o,["parameters","outputOptions","compressionQuality"],g),y=tl(p,["enhanceInputImage"]),void 0!==o&&null!=y&&ti(o,["parameters","upscaleConfig","enhanceInputImage"],y),E=tl(p,["imagePreservationFactor"]),void 0!==o&&null!=E&&ti(o,["parameters","upscaleConfig","imagePreservationFactor"],E),_=tl(p,["labels"]),void 0!==o&&null!=_&&ti(o,["labels"],_),T=tl(p,["numberOfImages"]),void 0!==o&&null!=T&&ti(o,["parameters","sampleCount"],T),v=tl(p,["mode"]),void 0!==o&&null!=v&&ti(o,["parameters","mode"],v)),o);return l=tn("{model}:predict",I._url),r=I._query,delete I._url,delete I._query,this.apiClient.request({path:l,queryParams:r,body:JSON.stringify(I),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nI(e))),ti(t,["generatedImages"],e)}return t}(e),n=new tc;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n,i;let l="",r={};if(this.apiClient.isVertexAI()){let o,a,s,u,p,d,c,h,m,f,g,y,E,_,T,v=(i=this.apiClient,o={},null!=(a=tl(e,["model"]))&&ti(o,["_url","model"],tx(i,a)),null!=(s=tl(e,["source"]))&&function(e,t){let n=tl(e,["prompt"]);void 0!==t&&null!=n&&ti(t,["instances[0]","prompt"],n);let i=tl(e,["personImage"]);void 0!==t&&null!=i&&ti(t,["instances[0]","personImage","image"],nS(i));let l=tl(e,["productImages"]);if(void 0!==t&&null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>{let t,n;return t={},null!=(n=tl(e,["productImage"]))&&ti(t,["image"],nS(n)),t})),ti(t,["instances[0]","productImages"],e)}}(s,o),null!=(u=tl(e,["config"]))&&(p=tl(u,["numberOfImages"]),void 0!==o&&null!=p&&ti(o,["parameters","sampleCount"],p),d=tl(u,["baseSteps"]),void 0!==o&&null!=d&&ti(o,["parameters","baseSteps"],d),c=tl(u,["outputGcsUri"]),void 0!==o&&null!=c&&ti(o,["parameters","storageUri"],c),h=tl(u,["seed"]),void 0!==o&&null!=h&&ti(o,["parameters","seed"],h),m=tl(u,["safetyFilterLevel"]),void 0!==o&&null!=m&&ti(o,["parameters","safetySetting"],m),f=tl(u,["personGeneration"]),void 0!==o&&null!=f&&ti(o,["parameters","personGeneration"],f),g=tl(u,["addWatermark"]),void 0!==o&&null!=g&&ti(o,["parameters","addWatermark"],g),y=tl(u,["outputMimeType"]),void 0!==o&&null!=y&&ti(o,["parameters","outputOptions","mimeType"],y),E=tl(u,["outputCompressionQuality"]),void 0!==o&&null!=E&&ti(o,["parameters","outputOptions","compressionQuality"],E),_=tl(u,["enhancePrompt"]),void 0!==o&&null!=_&&ti(o,["parameters","enhancePrompt"],_),T=tl(u,["labels"]),void 0!==o&&null!=T&&ti(o,["labels"],T)),o);return l=tn("{model}:predict",v._url),r=v._query,delete v._url,delete v._query,this.apiClient.request({path:l,queryParams:r,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=tl(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>nI(e))),ti(t,["generatedImages"],e)}return t}(e),n=new th;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n,i,l,r;let o="",a={};if(this.apiClient.isVertexAI()){let s,u,p,d,c,h,m,f,g,y,E,_,T,v,I,A=(i=this.apiClient,h={},null!=(m=tl(e,["model"]))&&ti(h,["_url","model"],tx(i,m)),null!=(f=tl(e,["source"]))&&(l=f,r=h,p=tl(l,["prompt"]),void 0!==r&&null!=p&&ti(r,["instances[0]","prompt"],p),d=tl(l,["image"]),void 0!==r&&null!=d&&ti(r,["instances[0]","image"],nS(d)),c=tl(l,["scribbleImage"]),void 0!==r&&null!=c&&ti(r,["instances[0]","scribble"],(s={},null!=(u=tl(c,["image"]))&&ti(s,["image"],nS(u)),s))),null!=(g=tl(e,["config"]))&&(y=tl(g,["mode"]),void 0!==h&&null!=y&&ti(h,["parameters","mode"],y),E=tl(g,["maxPredictions"]),void 0!==h&&null!=E&&ti(h,["parameters","maxPredictions"],E),_=tl(g,["confidenceThreshold"]),void 0!==h&&null!=_&&ti(h,["parameters","confidenceThreshold"],_),T=tl(g,["maskDilation"]),void 0!==h&&null!=T&&ti(h,["parameters","maskDilation"],T),v=tl(g,["binaryColorThreshold"]),void 0!==h&&null!=v&&ti(h,["parameters","binaryColorThreshold"],v),I=tl(g,["labels"]),void 0!==h&&null!=I&&ti(h,["labels"],I)),h);return o=tn("{model}:predict",A._url),a=A._query,delete A._url,delete A._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(A),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=tl(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["_self"]);null!=n&&ti(t,["mask"],nA(n));let i=tl(e,["labels"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["labels"],e)}return t})(e))),ti(t,["generatedMasks"],e)}return t}(e),n=new tm;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o=(r=this.apiClient,i={},null!=(l=tl(e,["model"]))&&ti(i,["_url","name"],tx(r,l)),i);return a=tn("{name}",o._url),s=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nb(e))}{let t,n,r=(o=this.apiClient,t={},null!=(n=tl(e,["model"]))&&ti(t,["_url","name"],tx(o,n)),t);return a=tn("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>nO(e))}}async listInternal(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o,u,p,d,c=(r=this.apiClient,i={},null!=(l=tl(e,["config"]))&&(o=tl(l,["pageSize"]),void 0!==i&&null!=o&&ti(i,["_query","pageSize"],o),u=tl(l,["pageToken"]),void 0!==i&&null!=u&&ti(i,["_query","pageToken"],u),p=tl(l,["filter"]),void 0!==i&&null!=p&&ti(i,["_query","filter"],p),d=tl(l,["queryBase"]),void 0!==i&&null!=d&&ti(i,["_url","models_url"],t2(r,d))),i);return a=tn("{models_url}",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["_self"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>nb(e))),ti(t,["models"],e)}return t}(e),n=new tf;return Object.assign(n,t),n})}{let t,n,r,u,p,d,c=(o=this.apiClient,t={},null!=(n=tl(e,["config"]))&&(r=tl(n,["pageSize"]),void 0!==t&&null!=r&&ti(t,["_query","pageSize"],r),u=tl(n,["pageToken"]),void 0!==t&&null!=u&&ti(t,["_query","pageToken"],u),p=tl(n,["filter"]),void 0!==t&&null!=p&&ti(t,["_query","filter"],p),d=tl(n,["queryBase"]),void 0!==t&&null!=d&&ti(t,["_url","models_url"],t2(o,d))),t);return a=tn("{models_url}",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["_self"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>nO(e))),ti(t,["models"],e)}return t}(e),n=new tf;return Object.assign(n,t),n})}}async update(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o,u,p,d,c=(r=this.apiClient,i={},null!=(l=tl(e,["model"]))&&ti(i,["_url","model"],tx(r,l)),null!=(o=tl(e,["config"]))&&(u=tl(o,["displayName"]),void 0!==i&&null!=u&&ti(i,["displayName"],u),p=tl(o,["description"]),void 0!==i&&null!=p&&ti(i,["description"],p),d=tl(o,["defaultCheckpointId"]),void 0!==i&&null!=d&&ti(i,["defaultCheckpointId"],d)),i);return a=tn("{model}",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nb(e))}{let t,n,r,u,p,d,c=(o=this.apiClient,t={},null!=(n=tl(e,["model"]))&&ti(t,["_url","name"],tx(o,n)),null!=(r=tl(e,["config"]))&&(u=tl(r,["displayName"]),void 0!==t&&null!=u&&ti(t,["displayName"],u),p=tl(r,["description"]),void 0!==t&&null!=p&&ti(t,["description"],p),d=tl(r,["defaultCheckpointId"]),void 0!==t&&null!=d&&ti(t,["defaultCheckpointId"],d)),t);return a=tn("{name}",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>nO(e))}}async delete(e){var t,n,i,l,r,o;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o=(r=this.apiClient,i={},null!=(l=tl(e,["model"]))&&ti(i,["_url","name"],tx(r,l)),i);return a=tn("{name}",o._url),s=o._query,delete o._url,delete o._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),t),l=new tg;return Object.assign(l,i),l})}{let t,n,r=(o=this.apiClient,t={},null!=(n=tl(e,["model"]))&&ti(t,["_url","name"],tx(o,n)),t);return a=tn("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),t),l=new tg;return Object.assign(l,i),l})}}async countTokens(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["_url","model"],tx(e,i));let l=tl(t,["contents"]);if(null!=l){let e=tK(l);Array.isArray(e)&&(e=e.map(e=>e)),ti(n,["contents"],e)}let r=tl(t,["config"]);return null!=r&&function(e,t){let n=tl(e,["systemInstruction"]);void 0!==t&&null!=n&&ti(t,["systemInstruction"],tJ(n));let i=tl(e,["tools"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nM(e))),ti(t,["tools"],e)}let l=tl(e,["generationConfig"]);void 0!==t&&null!=l&&ti(t,["generationConfig"],function(e){let t={},n=tl(e,["modelSelectionConfig"]);null!=n&&ti(t,["modelConfig"],n);let i=tl(e,["responseJsonSchema"]);null!=i&&ti(t,["responseJsonSchema"],i);let l=tl(e,["audioTimestamp"]);null!=l&&ti(t,["audioTimestamp"],l);let r=tl(e,["candidateCount"]);null!=r&&ti(t,["candidateCount"],r);let o=tl(e,["enableAffectiveDialog"]);null!=o&&ti(t,["enableAffectiveDialog"],o);let a=tl(e,["frequencyPenalty"]);null!=a&&ti(t,["frequencyPenalty"],a);let s=tl(e,["logprobs"]);null!=s&&ti(t,["logprobs"],s);let u=tl(e,["maxOutputTokens"]);null!=u&&ti(t,["maxOutputTokens"],u);let p=tl(e,["mediaResolution"]);null!=p&&ti(t,["mediaResolution"],p);let d=tl(e,["presencePenalty"]);null!=d&&ti(t,["presencePenalty"],d);let c=tl(e,["responseLogprobs"]);null!=c&&ti(t,["responseLogprobs"],c);let h=tl(e,["responseMimeType"]);null!=h&&ti(t,["responseMimeType"],h);let m=tl(e,["responseModalities"]);null!=m&&ti(t,["responseModalities"],m);let f=tl(e,["responseSchema"]);null!=f&&ti(t,["responseSchema"],f);let g=tl(e,["routingConfig"]);null!=g&&ti(t,["routingConfig"],g);let y=tl(e,["seed"]);null!=y&&ti(t,["seed"],y);let E=tl(e,["speechConfig"]);null!=E&&ti(t,["speechConfig"],nP(E));let _=tl(e,["stopSequences"]);null!=_&&ti(t,["stopSequences"],_);let T=tl(e,["temperature"]);null!=T&&ti(t,["temperature"],T);let v=tl(e,["thinkingConfig"]);null!=v&&ti(t,["thinkingConfig"],v);let I=tl(e,["topK"]);null!=I&&ti(t,["topK"],I);let A=tl(e,["topP"]);if(null!=A&&ti(t,["topP"],A),void 0!==tl(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(l))}(r,n),n}(this.apiClient,e);return r=tn("{model}:countTokens",i._url),o=i._query,delete i._url,delete i._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),null!=(i=tl(e,["totalTokens"]))&&ti(t,["totalTokens"],i),t),r=new ty;return Object.assign(r,l),r})}{let t=function(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["_url","model"],tx(e,i));let l=tl(t,["contents"]);if(null!=l){let e=tK(l);Array.isArray(e)&&(e=e.map(e=>ny(e))),ti(n,["contents"],e)}let r=tl(t,["config"]);return null!=r&&function(e){if(void 0!==tl(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==tl(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==tl(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(r),n}(this.apiClient,e);return r=tn("{model}:countTokens",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),null!=(i=tl(e,["totalTokens"]))&&ti(t,["totalTokens"],i),null!=(l=tl(e,["cachedContentTokenCount"]))&&ti(t,["cachedContentTokenCount"],l),t),o=new ty;return Object.assign(o,r),o})}}async computeTokens(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},i=tl(t,["model"]);null!=i&&ti(n,["_url","model"],tx(e,i));let l=tl(t,["contents"]);if(null!=l){let e=tK(l);Array.isArray(e)&&(e=e.map(e=>e)),ti(n,["contents"],e)}return n}(this.apiClient,e);return i=tn("{model}:computeTokens",r._url),l=r._query,delete r._url,delete r._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["tokensInfo"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["tokensInfo"],e)}return t}(e),n=new tE;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,i,l,r,o,a,s,u,p;let d="",c={};if(this.apiClient.isVertexAI()){let i,l,o,u,p,h,m,f,g,y,E=(r=this.apiClient,u={},null!=(p=tl(e,["model"]))&&ti(u,["_url","model"],tx(r,p)),null!=(h=tl(e,["prompt"]))&&ti(u,["instances[0]","prompt"],h),null!=(m=tl(e,["image"]))&&ti(u,["instances[0]","image"],nS(m)),null!=(f=tl(e,["video"]))&&ti(u,["instances[0]","video"],nw(f)),null!=(g=tl(e,["source"]))&&(a=g,s=u,i=tl(a,["prompt"]),void 0!==s&&null!=i&&ti(s,["instances[0]","prompt"],i),l=tl(a,["image"]),void 0!==s&&null!=l&&ti(s,["instances[0]","image"],nS(l)),o=tl(a,["video"]),void 0!==s&&null!=o&&ti(s,["instances[0]","video"],nw(o))),null!=(y=tl(e,["config"]))&&function(e,t){var n;let i,l,r,o=tl(e,["numberOfVideos"]);void 0!==t&&null!=o&&ti(t,["parameters","sampleCount"],o);let a=tl(e,["outputGcsUri"]);void 0!==t&&null!=a&&ti(t,["parameters","storageUri"],a);let s=tl(e,["fps"]);void 0!==t&&null!=s&&ti(t,["parameters","fps"],s);let u=tl(e,["durationSeconds"]);void 0!==t&&null!=u&&ti(t,["parameters","durationSeconds"],u);let p=tl(e,["seed"]);void 0!==t&&null!=p&&ti(t,["parameters","seed"],p);let d=tl(e,["aspectRatio"]);void 0!==t&&null!=d&&ti(t,["parameters","aspectRatio"],d);let c=tl(e,["resolution"]);void 0!==t&&null!=c&&ti(t,["parameters","resolution"],c);let h=tl(e,["personGeneration"]);void 0!==t&&null!=h&&ti(t,["parameters","personGeneration"],h);let m=tl(e,["pubsubTopic"]);void 0!==t&&null!=m&&ti(t,["parameters","pubsubTopic"],m);let f=tl(e,["negativePrompt"]);void 0!==t&&null!=f&&ti(t,["parameters","negativePrompt"],f);let g=tl(e,["enhancePrompt"]);void 0!==t&&null!=g&&ti(t,["parameters","enhancePrompt"],g);let y=tl(e,["generateAudio"]);void 0!==t&&null!=y&&ti(t,["parameters","generateAudio"],y);let E=tl(e,["lastFrame"]);void 0!==t&&null!=E&&ti(t,["instances[0]","lastFrame"],nS(E));let _=tl(e,["referenceImages"]);if(void 0!==t&&null!=_){let e=_;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l;return n={},null!=(i=tl(t=e,["image"]))&&ti(n,["image"],nS(i)),null!=(l=tl(t,["referenceType"]))&&ti(n,["referenceType"],l),n})),ti(t,["instances[0]","referenceImages"],e)}let T=tl(e,["mask"]);void 0!==t&&null!=T&&ti(t,["instances[0]","mask"],(i={},null!=(l=tl(n=T,["image"]))&&ti(i,["_self"],nS(l)),null!=(r=tl(n,["maskMode"]))&&ti(i,["maskMode"],r),i));let v=tl(e,["compressionQuality"]);void 0!==t&&null!=v&&ti(t,["parameters","compressionQuality"],v)}(y,u),u);return d=tn("{model}:predictLongRunning",E._url),c=E._query,delete E._url,delete E._query,this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(E),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,l,r,o,a=(t={},null!=(n=tl(e,["name"]))&&ti(t,["name"],n),null!=(i=tl(e,["metadata"]))&&ti(t,["metadata"],i),null!=(l=tl(e,["done"]))&&ti(t,["done"],l),null!=(r=tl(e,["error"]))&&ti(t,["error"],r),null!=(o=tl(e,["response"]))&&ti(t,["response"],function(e){let t={},n=tl(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a;return n={},null!=(i=tl(e,["_self"]))&&ti(n,["video"],(l={},null!=(r=tl(t=i,["gcsUri"]))&&ti(l,["uri"],r),null!=(o=tl(t,["bytesBase64Encoded"]))&&ti(l,["videoBytes"],tr(o)),null!=(a=tl(t,["mimeType"]))&&ti(l,["mimeType"],a),l)),n})),ti(t,["generatedVideos"],e)}let i=tl(e,["raiMediaFilteredCount"]);null!=i&&ti(t,["raiMediaFilteredCount"],i);let l=tl(e,["raiMediaFilteredReasons"]);return null!=l&&ti(t,["raiMediaFilteredReasons"],l),t}(o)),t),s=new t_;return Object.assign(s,a),s})}{let t,n,r,a,s,h,m,f,g,y,E=(o=this.apiClient,a={},null!=(s=tl(e,["model"]))&&ti(a,["_url","model"],tx(o,s)),null!=(h=tl(e,["prompt"]))&&ti(a,["instances[0]","prompt"],h),null!=(m=tl(e,["image"]))&&ti(a,["instances[0]","image"],nC(m)),null!=(f=tl(e,["video"]))&&ti(a,["instances[0]","video"],nD(f)),null!=(g=tl(e,["source"]))&&(u=g,p=a,t=tl(u,["prompt"]),void 0!==p&&null!=t&&ti(p,["instances[0]","prompt"],t),n=tl(u,["image"]),void 0!==p&&null!=n&&ti(p,["instances[0]","image"],nC(n)),r=tl(u,["video"]),void 0!==p&&null!=r&&ti(p,["instances[0]","video"],nD(r))),null!=(y=tl(e,["config"]))&&function(e,t){let n=tl(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&ti(t,["parameters","sampleCount"],n),void 0!==tl(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==tl(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let i=tl(e,["durationSeconds"]);if(void 0!==t&&null!=i&&ti(t,["parameters","durationSeconds"],i),void 0!==tl(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let l=tl(e,["aspectRatio"]);void 0!==t&&null!=l&&ti(t,["parameters","aspectRatio"],l);let r=tl(e,["resolution"]);void 0!==t&&null!=r&&ti(t,["parameters","resolution"],r);let o=tl(e,["personGeneration"]);if(void 0!==t&&null!=o&&ti(t,["parameters","personGeneration"],o),void 0!==tl(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let a=tl(e,["negativePrompt"]);void 0!==t&&null!=a&&ti(t,["parameters","negativePrompt"],a);let s=tl(e,["enhancePrompt"]);if(void 0!==t&&null!=s&&ti(t,["parameters","enhancePrompt"],s),void 0!==tl(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let u=tl(e,["lastFrame"]);void 0!==t&&null!=u&&ti(t,["instances[0]","lastFrame"],nC(u));let p=tl(e,["referenceImages"]);if(void 0!==t&&null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l;return n={},null!=(i=tl(t=e,["image"]))&&ti(n,["image"],nC(i)),null!=(l=tl(t,["referenceType"]))&&ti(n,["referenceType"],l),n})),ti(t,["instances[0]","referenceImages"],e)}if(void 0!==tl(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==tl(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(y,a),a);return d=tn("{model}:predictLongRunning",E._url),c=E._query,delete E._url,delete E._query,this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(E),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,l,r,o,a=(t={},null!=(n=tl(e,["name"]))&&ti(t,["name"],n),null!=(i=tl(e,["metadata"]))&&ti(t,["metadata"],i),null!=(l=tl(e,["done"]))&&ti(t,["done"],l),null!=(r=tl(e,["error"]))&&ti(t,["error"],r),null!=(o=tl(e,["response","generateVideoResponse"]))&&ti(t,["response"],function(e){let t={},n=tl(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a;return n={},null!=(i=tl(e,["video"]))&&ti(n,["video"],(l={},null!=(r=tl(t=i,["uri"]))&&ti(l,["uri"],r),null!=(o=tl(t,["encodedVideo"]))&&ti(l,["videoBytes"],tr(o)),null!=(a=tl(t,["encoding"]))&&ti(l,["mimeType"],a),l)),n})),ti(t,["generatedVideos"],e)}let i=tl(e,["raiMediaFilteredCount"]);null!=i&&ti(t,["raiMediaFilteredCount"],i);let l=tl(e,["raiMediaFilteredReasons"]);return null!=l&&ti(t,["raiMediaFilteredReasons"],l),t}(o)),t),s=new t_;return Object.assign(s,a),s})}}}class nZ extends tt{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(i={},null!=(l=tl(e,["operationName"]))&&ti(i,["_url","operationName"],l),i);return r=tn("{operationName}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}{let t,n,a=(t={},null!=(n=tl(e,["operationName"]))&&ti(t,["_url","operationName"],n),t);return r=tn("{operationName}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r,o,a,s=(r={},null!=(o=tl(e,["operationName"]))&&ti(r,["operationName"],o),null!=(a=tl(e,["resourceName"]))&&ti(r,["_url","resourceName"],a),r);return i=tn("{resourceName}:fetchPredictOperation",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class n0 extends tt{constructor(e){super(),this.apiClient=e}async create(e){var t,n,i,l,r;let o="",a={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let s,u,p,d,c,h,m,f,g,y,E=(i=this.apiClient,d={},null!=(c=tl(e,["config"]))&&ti(d,["config"],(h=tl(c,["expireTime"]),void 0!==d&&null!=h&&ti(d,["expireTime"],h),m=tl(c,["newSessionExpireTime"]),void 0!==d&&null!=m&&ti(d,["newSessionExpireTime"],m),f=tl(c,["uses"]),void 0!==d&&null!=f&&ti(d,["uses"],f),g=tl(c,["liveConnectConstraints"]),void 0!==d&&null!=g&&ti(d,["bidiGenerateContentSetup"],(l=i,s={},null!=(u=tl(r=g,["model"]))&&ti(s,["setup","model"],tx(l,u)),null!=(p=tl(r,["config"]))&&ti(s,["config"],function(e,t){let n=tl(e,["generationConfig"]);void 0!==t&&null!=n&&ti(t,["setup","generationConfig"],n);let i=tl(e,["responseModalities"]);void 0!==t&&null!=i&&ti(t,["setup","generationConfig","responseModalities"],i);let l=tl(e,["temperature"]);void 0!==t&&null!=l&&ti(t,["setup","generationConfig","temperature"],l);let r=tl(e,["topP"]);void 0!==t&&null!=r&&ti(t,["setup","generationConfig","topP"],r);let o=tl(e,["topK"]);void 0!==t&&null!=o&&ti(t,["setup","generationConfig","topK"],o);let a=tl(e,["maxOutputTokens"]);void 0!==t&&null!=a&&ti(t,["setup","generationConfig","maxOutputTokens"],a);let s=tl(e,["mediaResolution"]);void 0!==t&&null!=s&&ti(t,["setup","generationConfig","mediaResolution"],s);let u=tl(e,["seed"]);void 0!==t&&null!=u&&ti(t,["setup","generationConfig","seed"],u);let p=tl(e,["speechConfig"]);void 0!==t&&null!=p&&ti(t,["setup","generationConfig","speechConfig"],tz(p));let d=tl(e,["thinkingConfig"]);void 0!==t&&null!=d&&ti(t,["setup","generationConfig","thinkingConfig"],d);let c=tl(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&ti(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=tl(e,["systemInstruction"]);void 0!==t&&null!=h&&ti(t,["setup","systemInstruction"],function(e){let t={},n=tl(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,o,a,s,u,p,d,c,h;return n={},null!=(i=tl(t=e,["mediaResolution"]))&&ti(n,["mediaResolution"],i),null!=(l=tl(t,["codeExecutionResult"]))&&ti(n,["codeExecutionResult"],l),null!=(r=tl(t,["executableCode"]))&&ti(n,["executableCode"],r),null!=(o=tl(t,["fileData"]))&&ti(n,["fileData"],function(e){let t={};if(void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=tl(e,["fileUri"]);null!=n&&ti(t,["fileUri"],n);let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(o)),null!=(a=tl(t,["functionCall"]))&&ti(n,["functionCall"],function(e){let t={},n=tl(e,["id"]);null!=n&&ti(t,["id"],n);let i=tl(e,["args"]);null!=i&&ti(t,["args"],i);let l=tl(e,["name"]);if(null!=l&&ti(t,["name"],l),void 0!==tl(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==tl(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(a)),null!=(s=tl(t,["functionResponse"]))&&ti(n,["functionResponse"],s),null!=(u=tl(t,["inlineData"]))&&ti(n,["inlineData"],function(e){let t={},n=tl(e,["data"]);if(null!=n&&ti(t,["data"],n),void 0!==tl(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=tl(e,["mimeType"]);return null!=i&&ti(t,["mimeType"],i),t}(u)),null!=(p=tl(t,["text"]))&&ti(n,["text"],p),null!=(d=tl(t,["thought"]))&&ti(n,["thought"],d),null!=(c=tl(t,["thoughtSignature"]))&&ti(n,["thoughtSignature"],c),null!=(h=tl(t,["videoMetadata"]))&&ti(n,["videoMetadata"],h),n})),ti(t,["parts"],e)}let i=tl(e,["role"]);return null!=i&&ti(t,["role"],i),t}(tJ(h)));let m=tl(e,["tools"]);if(void 0!==t&&null!=m){let e=tQ(m);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=tl(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["functionDeclarations"],e)}if(void 0!==tl(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tl(e,["googleSearchRetrieval"]);null!=i&&ti(t,["googleSearchRetrieval"],i);let l=tl(e,["computerUse"]);null!=l&&ti(t,["computerUse"],l);let r=tl(e,["fileSearch"]);null!=r&&ti(t,["fileSearch"],r);let o=tl(e,["codeExecution"]);if(null!=o&&ti(t,["codeExecution"],o),void 0!==tl(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=tl(e,["googleMaps"]);null!=a&&ti(t,["googleMaps"],function(e){let t={};if(void 0!==tl(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=tl(e,["enableWidget"]);return null!=n&&ti(t,["enableWidget"],n),t}(a));let s=tl(e,["googleSearch"]);null!=s&&ti(t,["googleSearch"],function(e){let t={};if(void 0!==tl(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==tl(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=tl(e,["timeRangeFilter"]);return null!=n&&ti(t,["timeRangeFilter"],n),t}(s));let u=tl(e,["urlContext"]);return null!=u&&ti(t,["urlContext"],u),t})(tX(e)))),ti(t,["setup","tools"],e)}let f=tl(e,["sessionResumption"]);void 0!==t&&null!=f&&ti(t,["setup","sessionResumption"],function(e){let t={},n=tl(e,["handle"]);if(null!=n&&ti(t,["handle"],n),void 0!==tl(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(f));let g=tl(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&ti(t,["setup","inputAudioTranscription"],g);let y=tl(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&ti(t,["setup","outputAudioTranscription"],y);let E=tl(e,["realtimeInputConfig"]);void 0!==t&&null!=E&&ti(t,["setup","realtimeInputConfig"],E);let _=tl(e,["contextWindowCompression"]);void 0!==t&&null!=_&&ti(t,["setup","contextWindowCompression"],_);let T=tl(e,["proactivity"]);return void 0!==t&&null!=T&&ti(t,["setup","proactivity"],T),{}}(p,s)),s)),y=tl(c,["lockAdditionalFields"]),void 0!==d&&null!=y&&ti(d,["fieldMask"],y),{})),d);o=tn("auth_tokens",E._url),a=E._query,delete E.config,delete E._url,delete E._query;let _=function(e,t){let n=null,i=e.bidiGenerateContentSetup;if("object"==typeof i&&null!==i&&"setup"in i){let t=i.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==i&&delete e.bidiGenerateContentSetup;let l=e.fieldMask;if(n){let i=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n];if("object"==typeof i&&null!=i&&Object.keys(i).length>0){let e=Object.keys(i).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==l&&Array.isArray(l)&&l.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];l.length>0&&(n=l.map(e=>t.includes(e)?`generationConfig.${e}`:e));let r=[];i&&r.push(i),n.length>0&&r.push(...n),r.length>0?e.fieldMask=r.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==l&&Array.isArray(l)&&l.length>0?e.fieldMask=l.join(","):delete e.fieldMask;return e}(E,e.config);return this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(_),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}class n1 extends tt{constructor(e){super(),this.apiClient=e,this.list=async e=>new nn(e6.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a=(r={},null!=(o=tl(e,["name"]))&&ti(r,["_url","name"],o),r);return i=tn("{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s,u=(r={},null!=(o=tl(e,["name"]))&&ti(r,["_url","name"],o),null!=(a=tl(e,["config"]))&&(s=tl(a,["force"]),void 0!==r&&null!=s&&ti(r,["_query","force"],s)),r);i=tn("{name}",u._url),l=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s,u,p=(r={},null!=(o=tl(e,["parent"]))&&ti(r,["_url","parent"],o),null!=(a=tl(e,["config"]))&&(s=tl(a,["pageSize"]),void 0!==r&&null!=s&&ti(r,["_query","pageSize"],s),u=tl(a,["pageToken"]),void 0!==r&&null!=u&&ti(r,["_query","pageToken"],u)),r);return i=tn("{parent}/documents",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["documents"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["documents"],e)}return t}(e),n=new tA;return Object.assign(n,t),n})}}}class n2 extends tt{constructor(e,t=new n1(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new nn(e6.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s=(r={},null!=(o=tl(e,["config"]))&&(a=tl(o,["displayName"]),void 0!==r&&null!=a&&ti(r,["displayName"],a)),r);return i=tn("fileSearchStores",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a=(r={},null!=(o=tl(e,["name"]))&&ti(r,["_url","name"],o),r);return i=tn("{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s,u=(r={},null!=(o=tl(e,["name"]))&&ti(r,["_url","name"],o),null!=(a=tl(e,["config"]))&&(s=tl(a,["force"]),void 0!==r&&null!=s&&ti(r,["_query","force"],s)),r);i=tn("{name}",u._url),l=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s,u=(r={},null!=(o=tl(e,["config"]))&&(a=tl(o,["pageSize"]),void 0!==r&&null!=a&&ti(r,["_query","pageSize"],a),s=tl(o,["pageToken"]),void 0!==r&&null!=s&&ti(r,["_query","pageToken"],s)),r);return i=tn("fileSearchStores",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=tl(e,["sdkHttpResponse"]);null!=n&&ti(t,["sdkHttpResponse"],n);let i=tl(e,["nextPageToken"]);null!=i&&ti(t,["nextPageToken"],i);let l=tl(e,["fileSearchStores"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["fileSearchStores"],e)}return t}(e),n=new tC;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s=(r={},null!=(o=tl(e,["fileSearchStoreName"]))&&ti(r,["_url","file_search_store_name"],o),null!=(a=tl(e,["config"]))&&function(e,t){let n=tl(e,["mimeType"]);void 0!==t&&null!=n&&ti(t,["mimeType"],n);let i=tl(e,["displayName"]);void 0!==t&&null!=i&&ti(t,["displayName"],i);let l=tl(e,["customMetadata"]);if(void 0!==t&&null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["customMetadata"],e)}let r=tl(e,["chunkingConfig"]);void 0!==t&&null!=r&&ti(t,["chunkingConfig"],r)}(a,r),r);return i=tn("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i=(t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),t),l=new tS;return Object.assign(l,i),l})}}async importFile(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s,u=(r={},null!=(o=tl(e,["fileSearchStoreName"]))&&ti(r,["_url","file_search_store_name"],o),null!=(a=tl(e,["fileName"]))&&ti(r,["fileName"],a),null!=(s=tl(e,["config"]))&&function(e,t){let n=tl(e,["customMetadata"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti(t,["customMetadata"],e)}let i=tl(e,["chunkingConfig"]);void 0!==t&&null!=i&&ti(t,["chunkingConfig"],i)}(s,r),r);return i=tn("{file_search_store_name}:importFile",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{var t;let n,i,l,r,o,a,s,u,p,d,c=(o={},null!=(a=tl(e,["name"]))&&ti(o,["name"],a),null!=(s=tl(e,["metadata"]))&&ti(o,["metadata"],s),null!=(u=tl(e,["done"]))&&ti(o,["done"],u),null!=(p=tl(e,["error"]))&&ti(o,["error"],p),null!=(d=tl(e,["response"]))&&ti(o,["response"],(n={},null!=(i=tl(t=d,["sdkHttpResponse"]))&&ti(n,["sdkHttpResponse"],i),null!=(l=tl(t,["parent"]))&&ti(n,["parent"],l),null!=(r=tl(t,["documentName"]))&&ti(n,["documentName"],r),n)),o),h=new tO;return Object.assign(h,c),h})}}}function n4(e,t){let n,i,l,r={},o=tl(e,["sdkHttpResponse"]);null!=o&&ti(r,["sdkHttpResponse"],o);let a=tl(e,["name"]);null!=a&&ti(r,["name"],a);let s=tl(e,["state"]);null!=s&&ti(r,["state"],t0(s));let u=tl(e,["createTime"]);null!=u&&ti(r,["createTime"],u);let p=tl(e,["tuningTask","startTime"]);null!=p&&ti(r,["startTime"],p);let d=tl(e,["tuningTask","completeTime"]);null!=d&&ti(r,["endTime"],d);let c=tl(e,["updateTime"]);null!=c&&ti(r,["updateTime"],c);let h=tl(e,["description"]);null!=h&&ti(r,["description"],h);let m=tl(e,["baseModel"]);null!=m&&ti(r,["baseModel"],m);let f=tl(e,["_self"]);return null!=f&&ti(r,["tunedModel"],(n={},null!=(i=tl(f,["name"]))&&ti(n,["model"],i),null!=(l=tl(f,["name"]))&&ti(n,["endpoint"],l),n)),r}function n5(e,t){let n={},i=tl(e,["sdkHttpResponse"]);null!=i&&ti(n,["sdkHttpResponse"],i);let l=tl(e,["name"]);null!=l&&ti(n,["name"],l);let r=tl(e,["state"]);null!=r&&ti(n,["state"],t0(r));let o=tl(e,["createTime"]);null!=o&&ti(n,["createTime"],o);let a=tl(e,["startTime"]);null!=a&&ti(n,["startTime"],a);let s=tl(e,["endTime"]);null!=s&&ti(n,["endTime"],s);let u=tl(e,["updateTime"]);null!=u&&ti(n,["updateTime"],u);let p=tl(e,["error"]);null!=p&&ti(n,["error"],p);let d=tl(e,["description"]);null!=d&&ti(n,["description"],d);let c=tl(e,["baseModel"]);null!=c&&ti(n,["baseModel"],c);let h=tl(e,["tunedModel"]);null!=h&&ti(n,["tunedModel"],h);let m=tl(e,["preTunedModel"]);null!=m&&ti(n,["preTunedModel"],m);let f=tl(e,["supervisedTuningSpec"]);null!=f&&ti(n,["supervisedTuningSpec"],f);let g=tl(e,["preferenceOptimizationSpec"]);null!=g&&ti(n,["preferenceOptimizationSpec"],g);let y=tl(e,["tuningDataStats"]);null!=y&&ti(n,["tuningDataStats"],y);let E=tl(e,["encryptionSpec"]);null!=E&&ti(n,["encryptionSpec"],E);let _=tl(e,["partnerModelTuningSpec"]);null!=_&&ti(n,["partnerModelTuningSpec"],_);let T=tl(e,["customBaseModel"]);null!=T&&ti(n,["customBaseModel"],T);let v=tl(e,["experiment"]);null!=v&&ti(n,["experiment"],v);let I=tl(e,["labels"]);null!=I&&ti(n,["labels"],I);let A=tl(e,["outputUri"]);null!=A&&ti(n,["outputUri"],A);let C=tl(e,["pipelineJob"]);null!=C&&ti(n,["pipelineJob"],C);let S=tl(e,["serviceAccount"]);null!=S&&ti(n,["serviceAccount"],S);let O=tl(e,["tunedModelDisplayName"]);null!=O&&ti(n,["tunedModelDisplayName"],O);let b=tl(e,["veoTuningSpec"]);return null!=b&&ti(n,["veoTuningSpec"],b),n}function n3(e,t){let n={},i=tl(e,["gcsUri"]);null!=i&&ti(n,["validationDatasetUri"],i);let l=tl(e,["vertexDatasetResource"]);return null!=l&&ti(n,["validationDatasetUri"],l),n}class n6 extends tt{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new nn(e6.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null==(t=e.config)?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let i=Object.assign(Object.assign({},e),{preTunedModel:n});return i.baseModel=void 0,await this.tuneInternal(i)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),i="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?i=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:eN.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],l),i);return r=tn("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>n5(e))}{let t,n,a=(t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],n),t);return r=tn("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>n4(e))}}async listInternal(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i,l,a,s,u,p=(i={},null!=(l=tl(e,["config"]))&&(a=tl(l,["pageSize"]),void 0!==i&&null!=a&&ti(i,["_query","pageSize"],a),s=tl(l,["pageToken"]),void 0!==i&&null!=s&&ti(i,["_query","pageToken"],s),u=tl(l,["filter"]),void 0!==i&&null!=u&&ti(i,["_query","filter"],u)),i);return r=tn("tuningJobs",p._url),o=p._query,delete p._url,delete p._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},i=tl(e,["sdkHttpResponse"]);null!=i&&ti(n,["sdkHttpResponse"],i);let l=tl(e,["nextPageToken"]);null!=l&&ti(n,["nextPageToken"],l);let r=tl(e,["tuningJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>n5(e))),ti(n,["tuningJobs"],e)}return n}(e),n=new tT;return Object.assign(n,t),n})}{let t,n,a,s,u,p=(t={},null!=(n=tl(e,["config"]))&&(a=tl(n,["pageSize"]),void 0!==t&&null!=a&&ti(t,["_query","pageSize"],a),s=tl(n,["pageToken"]),void 0!==t&&null!=s&&ti(t,["_query","pageToken"],s),u=tl(n,["filter"]),void 0!==t&&null!=u&&ti(t,["_query","filter"],u)),t);return r=tn("tunedModels",p._url),o=p._query,delete p._url,delete p._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},i=tl(e,["sdkHttpResponse"]);null!=i&&ti(n,["sdkHttpResponse"],i);let l=tl(e,["nextPageToken"]);null!=l&&ti(n,["nextPageToken"],l);let r=tl(e,["tunedModels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>n4(e))),ti(n,["tuningJobs"],e)}return n}(e),n=new tT;return Object.assign(n,t),n})}}async cancel(e){var t,n,i,l;let r="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(i={},null!=(l=tl(e,["name"]))&&ti(i,["_url","name"],l),i);r=tn("{name}:cancel",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,a=(t={},null!=(n=tl(e,["name"]))&&ti(t,["_url","name"],n),t);r=tn("{name}:cancel",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal})}}async tuneInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r,o,a,s,u,p=(r={},null!=(o=tl(e,["baseModel"]))&&ti(r,["baseModel"],o),null!=(a=tl(e,["preTunedModel"]))&&ti(r,["preTunedModel"],a),null!=(s=tl(e,["trainingDataset"]))&&function(e,t,n){let i=tl(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let n=tl(e,["gcsUri"]);void 0!==t&&null!=n&&ti(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===i){let n=tl(e,["gcsUri"]);void 0!==t&&null!=n&&ti(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}let l=tl(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){let n=tl(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&ti(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===l){let n=tl(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&ti(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}if(void 0!==tl(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(s,r,e),null!=(u=tl(e,["config"]))&&function(e,t,n){let i=tl(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let n=tl(e,["validationDataset"]);void 0!==t&&null!=n&&ti(t,["supervisedTuningSpec"],n3(n))}else if("PREFERENCE_TUNING"===i){let n=tl(e,["validationDataset"]);void 0!==t&&null!=n&&ti(t,["preferenceOptimizationSpec"],n3(n))}let l=tl(e,["tunedModelDisplayName"]);void 0!==t&&null!=l&&ti(t,["tunedModelDisplayName"],l);let r=tl(e,["description"]);void 0!==t&&null!=r&&ti(t,["description"],r);let o=tl(n,["config","method"]);if(void 0===o&&(o="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===o){let n=tl(e,["epochCount"]);void 0!==t&&null!=n&&ti(t,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===o){let n=tl(e,["epochCount"]);void 0!==t&&null!=n&&ti(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}let a=tl(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){let n=tl(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&ti(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===a){let n=tl(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&ti(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}let s=tl(n,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){let n=tl(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&ti(t,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===s){let n=tl(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&ti(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}let u=tl(n,["config","method"]);if(void 0===u&&(u="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===u){let n=tl(e,["adapterSize"]);void 0!==t&&null!=n&&ti(t,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===u){let n=tl(e,["adapterSize"]);void 0!==t&&null!=n&&ti(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}if(void 0!==tl(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==tl(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let p=tl(e,["labels"]);void 0!==t&&null!=p&&ti(t,["labels"],p);let d=tl(e,["beta"]);void 0!==t&&null!=d&&ti(t,["preferenceOptimizationSpec","hyperParameters","beta"],d)}(u,r,e),r);return i=tn("tuningJobs",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>n5(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,o,a,s,u,p=(r={},null!=(o=tl(e,["baseModel"]))&&ti(r,["baseModel"],o),null!=(a=tl(e,["preTunedModel"]))&&ti(r,["preTunedModel"],a),null!=(s=tl(e,["trainingDataset"]))&&function(e,t){if(void 0!==tl(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==tl(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=tl(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ti({},["examples","examples"],e)}}(s),null!=(u=tl(e,["config"]))&&function(e,t,n){if(void 0!==tl(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let i=tl(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=i&&ti(t,["displayName"],i),void 0!==tl(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let l=tl(e,["epochCount"]);void 0!==t&&null!=l&&ti(t,["tuningTask","hyperparameters","epochCount"],l);let r=tl(e,["learningRateMultiplier"]);if(null!=r&&ti({},["tuningTask","hyperparameters","learningRateMultiplier"],r),void 0!==tl(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==tl(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==tl(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let o=tl(e,["batchSize"]);void 0!==t&&null!=o&&ti(t,["tuningTask","hyperparameters","batchSize"],o);let a=tl(e,["learningRate"]);if(void 0!==t&&null!=a&&ti(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==tl(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==tl(e,["beta"]))throw Error("beta parameter is not supported in Gemini API.")}(u,r),r);return i=tn("tunedModels",p._url),l=p._query,delete p._url,delete p._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r,o;return t={},null!=(n=tl(e,["sdkHttpResponse"]))&&ti(t,["sdkHttpResponse"],n),null!=(i=tl(e,["name"]))&&ti(t,["name"],i),null!=(l=tl(e,["metadata"]))&&ti(t,["metadata"],l),null!=(r=tl(e,["done"]))&&ti(t,["done"],r),null!=(o=tl(e,["error"]))&&ti(t,["error"],o),t})}}}class n8{async download(e,t){throw Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}let n7="x-goog-upload-status";async function n9(e,t,n){var i;let l=await it(e,t,n),r=await (null==l?void 0:l.json());if((null==(i=null==l?void 0:l.headers)?void 0:i[n7])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return r.file}async function ie(e,t,n){var i;let l=await it(e,t,n),r=await (null==l?void 0:l.json());if((null==(i=null==l?void 0:l.headers)?void 0:i[n7])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let o=to(r),a=new tw;return Object.assign(a,o),a}async function it(e,t,n){var i,l;let r=0,o=0,a=new ta(new Response),s="upload";for(r=e.size;o<r;){let u=Math.min(8388608,r-o),p=e.slice(o,o+u);o+u>=r&&(s+=", finalize");let d=0,c=1e3;for(;d<3&&(null==(i=null==(a=await n.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":s,"X-Goog-Upload-Offset":String(o),"Content-Length":String(u)}}}))?void 0:a.headers)||!i[n7]);)d++,await function(e){return new Promise(t=>setTimeout(t,e))}(c),c*=2;if(o+=u,(null==(l=null==a?void 0:a.headers)?void 0:l[n7])!=="active")break;if(r<=o)throw Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function ii(e){return{size:e.size,type:e.type}}class il{async upload(e,t,n){if("string"==typeof e)throw Error("File path is not supported in browser uploader.");return await n9(e,t,n)}async uploadToFileSearchStore(e,t,n){if("string"==typeof e)throw Error("File path is not supported in browser uploader.");return await ie(e,t,n)}async stat(e){if("string"!=typeof e)return await ii(e);throw Error("File path is not supported in browser uploader.")}}class ir{create(e,t,n){return new io(e,t,n)}}class io{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}let ia="x-goog-api-key";class is{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(null===e.get(ia)){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw Error("API key is missing. Please provide a valid API key.");e.append(ia,this.apiKey)}}}let iu=new class{constructor(e){var i;if(null==e.apiKey)throw Error("An API Key must be set when running in a browser");if(e.project||e.location)throw Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!=(i=e.vertexai)&&i,this.apiKey=e.apiKey;const l=function(e,i,l,r){return(null==e?void 0:e.baseUrl)?e.baseUrl:i?null!=n?n:l:null!=t?t:r}(e.httpOptions,e.vertexai,void 0,void 0);l&&(e.httpOptions?e.httpOptions.baseUrl=l:e.httpOptions={baseUrl:l}),this.apiVersion=e.apiVersion;const r=new is(this.apiKey);this.apiClient=new nk({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/web",uploader:new il,downloader:new n8}),this.models=new nQ(this.apiClient),this.live=new nJ(this.apiClient,r,new ir),this.batches=new ni(this.apiClient),this.chats=new nd(this.models,this.apiClient),this.caches=new nr(this.apiClient),this.files=new nm(this.apiClient),this.operations=new nZ(this.apiClient),this.authTokens=new n0(this.apiClient),this.tunings=new n6(this.apiClient),this.fileSearchStores=new n2(this.apiClient)}}({apiKey:"AIzaSyArhE5r_W9ZNIMt8JywFatE184QvlLARiM"}),ip=async e=>{try{let t=e.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),n=`
      Analyze this receipt image (which may be in Turkish or English) and extract the transaction details.
      
      CRITICAL INSTRUCTION FOR AMOUNT:
      1. Look for the "Total", "Genel Toplam", "Toplam" or "Grand Total" amount.
      2. If the total is NOT visible, cut off, or unclear, you MUST extract all visible individual line item prices and SUM them up manually.
      3. Use this calculated sum as the 'amount'.

      Extract the following:
      1. Total Amount (number only). If total is not found, sum the visible items.
      2. Merchant Name (store name).
      3. Date (in YYYY-MM-DD format, if not found use today's date).
      4. Category. Map the transaction to one of these exact Turkish categories:
         - "Market" (Grocery, Supermarket, Convenience Store)
         - "Yeme & \xe7me" (Restaurant, Cafe, Food, Starbucks)
         - "Ulam" (Transport, Fuel, Taxi, Bus)
         - "Fatura" (Bills, Utilities, Phone, Internet)
         - "Dier" (Other, Shopping, Health, Entertainment)
      5. Summary: A short description of items purchased. IMPORTANT: Write the summary in Turkish, even if the receipt is in English.
    `,i=await iu.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:t}},{text:n}]},config:{responseMimeType:"application/json",responseSchema:{type:es.OBJECT,properties:{amount:{type:es.NUMBER,description:"The total amount paid. If total is missing, this is the sum of visible items."},merchant:{type:es.STRING,description:"The name of the store or merchant"},date:{type:es.STRING,description:"The date of the transaction in YYYY-MM-DD format"},category:{type:es.STRING,description:"The category of the expense (Must be one of: Market, Yeme & me, Ulam, Fatura, Dier)"},summary:{type:es.STRING,description:"A short description of items purchased in Turkish"}},required:["amount","merchant","date","category"]}}});if(i.text)return JSON.parse(i.text);return null}catch(e){throw console.error("Error scanning receipt with Gemini:",e),e}};var id=e.i(64807),ic=e.i(91588);let ih=[50,100,250,500];function im(){let e=(0,e9.useRouter)(),{mode:t,activeFamily:n}=(0,ic.useFamily)(),[i,l]=(0,e7.useState)([]),r=(0,e7.useRef)(null),[o,a]=(0,e7.useState)(id.TransactionType.EXPENSE),[s,u]=(0,e7.useState)(""),[p,d]=(0,e7.useState)(""),[c,h]=(0,e7.useState)(new Date().toISOString().split("T")[0]),[m,f]=(0,e7.useState)(""),[g,y]=(0,e7.useState)(null),[E,_]=(0,e7.useState)(!1),[T,v]=(0,e7.useState)(null),[I,A]=(0,e7.useState)(!0);(0,e7.useEffect)(()=>{(async()=>{try{let e;if("family"===t&&n){let t=await fetch(`/api/family-categories?familyId=${n.id}`);e=(await t.json()).categories||[]}else e=await te.categoriesApi.getAll();if(l(e),e.length>0){let t=e.find(e=>e.type===id.TransactionType.EXPENSE)||e[0];t&&d(t.id)}}catch(e){console.error("Error loading categories:",e)}finally{A(!1)}})()},[t,n]),(0,e7.useEffect)(()=>{if(0===i.length)return;let e=i.filter(e=>e.type===o);0===e.length?d(""):e.find(e=>e.id===p)||d(e[0].id)},[o,i,p]);let C=async e=>{let t=e.target.files?.[0];if(t){_(!0),v(null);try{let e=new FileReader;e.onloadend=async()=>{let t=e.result;y(t);try{let e=await ip(t);if(e){u(e.amount.toString()),f(e.merchant||e.summary||""),e.date&&h(e.date);let t=i.find(t=>t.name.toLowerCase()===e.category.toLowerCase()||e.category.toLowerCase().includes("market")&&"market"===t.name.toLowerCase()||e.category.toLowerCase().includes("food")&&t.name.toLowerCase().includes("yeme"));t&&(d(t.id),a(t.type))}}catch(e){console.error(e),v("Fi taranamad, ltfen bilgileri manuel girin.")}finally{_(!1)}},e.readAsDataURL(t)}catch(e){_(!1),v("Resim yklenirken hata olutu.")}}},S=async()=>{if(!s||isNaN(parseFloat(s)))return void v("Ltfen geerli bir tutar girin.");if(!p)return void v("Ltfen kategori sein.");try{if("family"===t&&n){if(!(await fetch("/api/family-transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({familyId:n.id,amount:parseFloat(s),description:m||(o===id.TransactionType.INCOME?"Gelir":"Gider"),date:c,categoryId:p,type:o,receiptImage:g||null})})).ok)throw Error("Failed to create family transaction")}else await te.transactionsApi.create({id:crypto.randomUUID(),amount:parseFloat(s),description:m||(o===id.TransactionType.INCOME?"Gelir":"Gider"),date:c,categoryId:p,type:o,receiptImage:g||void 0,createdAt:Date.now()});e.push("/")}catch(e){console.error("Error saving transaction:",e),v("lem kaydedilemedi. Ltfen tekrar deneyin.")}};return I?(0,e8.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,e8.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):(0,e8.jsxs)("div",{className:"flex flex-col min-h-screen bg-background-light dark:bg-background-dark",children:[(0,e8.jsxs)("div",{className:"sticky top-0 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur z-10",children:[(0,e8.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,e8.jsx)("button",{onClick:()=>e.back(),className:"p-2 -ml-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10",children:(0,e8.jsx)("span",{className:"material-symbols-outlined",children:"arrow_back"})}),(0,e8.jsx)("h1",{className:"text-lg font-bold",children:"Yeni lem Ekle"}),(0,e8.jsx)("button",{onClick:()=>r.current?.click(),className:`p-2 -mr-2 rounded-full ${E?"animate-pulse text-primary":"hover:bg-black/5 dark:hover:bg-white/10"}`,disabled:E,children:(0,e8.jsx)("span",{className:"material-symbols-outlined",children:E?"hourglass_top":"photo_camera"})}),(0,e8.jsx)("input",{type:"file",ref:r,className:"hidden",accept:"image/*",capture:"environment",onChange:C})]}),"family"===t&&n&&(0,e8.jsx)("div",{className:"px-4 pb-3",children:(0,e8.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[(0,e8.jsx)("span",{className:"material-symbols-outlined text-green-600 text-lg",children:"groups"}),(0,e8.jsxs)("span",{className:"text-sm text-green-800 dark:text-green-200",children:[(0,e8.jsx)("span",{className:"font-semibold",children:n.name})," ailesine kaydediliyor"]})]})})]}),(0,e8.jsxs)("div",{className:"flex-1 px-4 pb-nav-safe overflow-y-auto space-y-5",children:[T&&(0,e8.jsx)("div",{className:"p-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-200 text-sm border border-red-200 dark:border-red-800",children:T}),(0,e8.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark border border-gray-100 dark:border-gray-800 p-4 shadow-sm",children:[(0,e8.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,e8.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary/10 text-primary flex items-center justify-center",children:(0,e8.jsx)("span",{className:"material-symbols-outlined",children:"receipt_long"})}),(0,e8.jsxs)("div",{children:[(0,e8.jsx)("p",{className:"text-sm font-semibold",children:"Fi Tara"}),(0,e8.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Tutar, tarih ve kategori otomatik dolsun."})]})]}),(0,e8.jsxs)("button",{onClick:()=>r.current?.click(),disabled:E,className:"w-full h-14 rounded-xl border border-dashed border-gray-300 dark:border-gray-700 text-sm font-semibold flex items-center justify-center gap-2 hover:border-primary hover:text-primary transition disabled:opacity-70",children:[(0,e8.jsx)("span",{className:"material-symbols-outlined text-base",children:E?"hourglass_top":"camera"}),E?"Taranyor...":"Kamera veya galeriden fi ekle"]}),g&&(0,e8.jsxs)("div",{className:"mt-4 relative h-36 w-full rounded-xl overflow-hidden",children:[(0,e8.jsx)("img",{src:g,alt:"Receipt",className:"w-full h-full object-cover"}),(0,e8.jsx)("button",{onClick:()=>y(null),className:"absolute top-2 right-2 bg-black/60 text-white p-1.5 rounded-full",children:(0,e8.jsx)("span",{className:"material-symbols-outlined text-sm",children:"close"})})]})]}),(0,e8.jsxs)("div",{className:"flex p-1 bg-gray-200 dark:bg-surface-dark rounded-xl",children:[(0,e8.jsx)("button",{onClick:()=>a(id.TransactionType.EXPENSE),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${o===id.TransactionType.EXPENSE?"bg-white dark:bg-[#2a3b30] shadow-sm text-gray-900 dark:text-white":"text-gray-500"}`,children:"Gider"}),(0,e8.jsx)("button",{onClick:()=>a(id.TransactionType.INCOME),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${o===id.TransactionType.INCOME?"bg-white dark:bg-[#2a3b30] shadow-sm text-gray-900 dark:text-white":"text-gray-500"}`,children:"Gelir"})]}),(0,e8.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark border border-gray-100 dark:border-gray-800 p-4 shadow-sm space-y-3",children:[(0,e8.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e8.jsx)("label",{className:"text-sm font-semibold text-gray-600 dark:text-gray-300",children:"Tutar"}),(0,e8.jsx)("span",{className:"text-xs text-gray-500",children:"TRY"})]}),(0,e8.jsxs)("div",{className:"relative",children:[(0,e8.jsx)("input",{type:"number",value:s,onChange:e=>u(e.target.value),placeholder:"0.00",className:`w-full h-20 bg-transparent text-5xl font-bold text-center outline-none placeholder:text-gray-300 dark:placeholder:text-gray-700 ${o===id.TransactionType.EXPENSE?"text-red-500":"text-primary"}`}),(0,e8.jsx)("span",{className:`absolute top-1/2 -translate-y-1/2 right-4 text-2xl font-medium text-gray-400 ${!s&&"opacity-0"}`,children:""})]}),(0,e8.jsx)("div",{className:"flex flex-wrap gap-2",children:ih.map(e=>(0,e8.jsxs)("button",{onClick:()=>u(e.toString()),className:"px-3 py-2 rounded-full text-sm font-semibold bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-primary/10 hover:text-primary transition",children:["",e]},e))})]}),(0,e8.jsxs)("div",{className:"space-y-5 rounded-2xl bg-white dark:bg-surface-dark border border-gray-100 dark:border-gray-800 p-4 shadow-sm",children:[(0,e8.jsxs)("div",{children:[(0,e8.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-600 dark:text-gray-400",children:"Kategori"}),(0,e8.jsxs)("div",{className:"relative",children:[(0,e8.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:(0,e8.jsx)("span",{className:"material-symbols-outlined text-lg",children:"category"})}),(0,e8.jsx)("select",{value:p,onChange:e=>d(e.target.value),className:"w-full h-14 pl-12 pr-10 appearance-none bg-gray-100 dark:bg-gray-800 rounded-xl outline-none border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-primary/50",children:i.filter(e=>e.type===o).map(e=>(0,e8.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,e8.jsx)("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:(0,e8.jsx)("span",{className:"material-symbols-outlined",children:"arrow_drop_down"})})]})]}),(0,e8.jsxs)("div",{children:[(0,e8.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-600 dark:text-gray-400",children:"Tarih"}),(0,e8.jsxs)("div",{className:"relative",children:[(0,e8.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none",children:(0,e8.jsx)("span",{className:"material-symbols-outlined text-lg",children:"event"})}),(0,e8.jsx)("input",{type:"date",value:c,onChange:e=>h(e.target.value),className:"w-full h-14 pl-12 pr-4 bg-gray-100 dark:bg-gray-800 rounded-xl outline-none border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-primary/50 hide-calendar-icon appearance-none"})]})]}),(0,e8.jsxs)("div",{children:[(0,e8.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-600 dark:text-gray-400",children:"Aklama"}),(0,e8.jsx)("input",{type:"text",value:m,onChange:e=>f(e.target.value),placeholder:o===id.TransactionType.EXPENSE?"rn: Akam yemei":"rn: Freelance i",className:"w-full h-14 px-4 bg-gray-100 dark:bg-gray-800 rounded-xl outline-none border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-primary/50 placeholder:text-gray-400"})]})]})]}),(0,e8.jsx)("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-safe bg-background-light dark:bg-background-dark border-t border-gray-200 dark:border-gray-800 z-20",children:(0,e8.jsx)("button",{onClick:S,disabled:!s||E,className:`w-full h-14 rounded-xl font-bold text-lg shadow-lg transition-all flex items-center justify-center gap-2
                ${!s||E?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-primary text-[#102216] shadow-primary/30 active:scale-[0.98]"}`,children:E?(0,e8.jsxs)(e8.Fragment,{children:[(0,e8.jsx)("span",{className:"animate-spin h-5 w-5 border-2 border-current border-t-transparent rounded-full"}),"Taranyor..."]}):"lemi Kaydet"})})]})}e.s(["default",()=>im],1076)}]);